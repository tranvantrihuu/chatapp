/*! For license information please see main.a74eb74e.js.LICENSE.txt */
(()=>{"use strict";var e={288:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function v(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var w=y.prototype=new v;w.constructor=y,m(w,_.prototype),w.isPureReactComponent=!0;var C=Array.isArray,b={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function E(e,t,r,i,s,o){return r=o.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:o}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var S=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function R(){}function P(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,h=!1;if(null===e)h=!0;else switch(a){case"bigint":case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case n:case r:h=!0;break;case d:return P((h=e._init)(e._payload),t,i,s,o)}}if(h)return o=o(e),h=""===s?"."+k(e,0):s,C(o)?(i="",null!=h&&(i=h.replace(S,"$&/")+"/"),P(o,t,i,"",(function(e){return e}))):null!=o&&(T(o)&&(l=o,c=i+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(S,"$&/")+"/")+h,o=E(l.type,c,void 0,0,0,l.props)),t.push(o)),1;h=0;var u,f=""===s?".":s+":";if(C(e))for(var m=0;m<e.length;m++)h+=P(s=e[m],t,i,a=f+k(s,m),o);else if("function"===typeof(m=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(e=m.call(e),m=0;!(s=e.next()).done;)h+=P(s=s.value,t,i,a=f+k(s,m++),o);else if("object"===a){if("function"===typeof e.then)return P(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(R,R):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,s,o);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return h}function N(e,t,n){if(null==e)return e;var r=[],i=0;return P(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function x(){}t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=i,t.Profiler=o,t.PureComponent=y,t.StrictMode=s,t.Suspense=h,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=b,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),i=e.key;if(null!=t)for(s in void 0!==t.ref&&void 0,void 0!==t.key&&(i=""+t.key),t)!I.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(r[s]=t[s]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var o=Array(s),a=0;a<s;a++)o[a]=arguments[a+2];r.children=o}return E(e.type,i,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var r,i={},s=null;if(null!=t)for(r in void 0!==t.key&&(s=""+t.key),t)I.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var a=Array(o),l=0;l<o;l++)a[l]=arguments[l+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===i[r]&&(i[r]=o[r]);return E(e,s,void 0,0,0,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=b.T,n={};b.T=n;try{var r=e(),i=b.S;null!==i&&i(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(x,A)}catch(ma){A(ma)}finally{b.T=t}},t.unstable_useCacheRefresh=function(){return b.H.useCacheRefresh()},t.use=function(e){return b.H.use(e)},t.useActionState=function(e,t,n){return b.H.useActionState(e,t,n)},t.useCallback=function(e,t){return b.H.useCallback(e,t)},t.useContext=function(e){return b.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return b.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return b.H.useEffect(e,t)},t.useId=function(){return b.H.useId()},t.useImperativeHandle=function(e,t,n){return b.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return b.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return b.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return b.H.useMemo(e,t)},t.useOptimistic=function(e,t){return b.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return b.H.useReducer(e,t,n)},t.useRef=function(e){return b.H.useRef(e)},t.useState=function(e){return b.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return b.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return b.H.useTransition()},t.version="19.0.0"},358:(e,t)=>{const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,r=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/,o=Object.prototype.toString,a=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function l(e,t,n){do{const n=e.charCodeAt(t);if(32!==n&&9!==n)return t}while(++t<n);return n}function c(e,t,n){for(;t>n;){const n=e.charCodeAt(--t);if(32!==n&&9!==n)return t+1}return n}function h(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},424:(e,t,n)=>{e.exports=n(288)},579:(e,t,n)=>{e.exports=n(799)},672:(e,t,n)=>{var r=n(424);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var o={d:{f:s,r:function(){throw Error(i(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=o.p;try{if(l.T=null,o.p=2,e)return e()}finally{l.T=t,o.p=n,o.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,o.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&o.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,s="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?o.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:s}):"script"===n&&o.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:s,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);o.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&o.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin);o.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);o.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else o.d.m(e)},t.requestFormReset=function(e){o.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.0.0"},799:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(e,t,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),"key"in t)for(var s in r={},t)"key"!==s&&(r[s]=t[s]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=i,t.jsxs=i},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();var r=n(424),i=n(950),s=(n(358),"popstate");function o(){return p((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return h("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:u(t)}),null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function a(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function l(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return{pathname:"string"===typeof e?e:e.pathname,search:"",hash:"",..."string"===typeof t?d(t):t,state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10)}}function u(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function d(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function p(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",p=null,f=m();function m(){return(l.state||{idx:null}).idx}function g(){d="POP";let e=m(),t=null==e?null:e-f;f=e,p&&p({action:d,location:v.location,delta:t})}function _(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:u(e);return n=n.replace(/ $/,"%20"),a(t,`No window.location.(origin|href) available to create URL for href: ${n}`),new URL(n,t)}null==f&&(f=0,l.replaceState({...l.state,idx:f},""));let v={get action(){return d},get location(){return e(i,l)},listen(e){if(p)throw new Error("A history only accepts one active listener");return i.addEventListener(s,g),p=e,()=>{i.removeEventListener(s,g),p=null}},createHref:e=>t(i,e),createURL:_,encodeLocation(e){let t=_(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){d="PUSH";let r=h(v.location,e,t);n&&n(r,e),f=m()+1;let s=c(r,f),a=v.createHref(r);try{l.pushState(s,"",a)}catch(ma){if(ma instanceof DOMException&&"DataCloneError"===ma.name)throw ma;i.location.assign(a)}o&&p&&p({action:d,location:v.location,delta:1})},replace:function(e,t){d="REPLACE";let r=h(v.location,e,t);n&&n(r,e),f=m();let i=c(r,f),s=v.createHref(r);l.replaceState(i,"",s),o&&p&&p({action:d,location:v.location,delta:0})},go:e=>l.go(e)};return v}new WeakMap;function f(e,t){return m(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function m(e,t,n,r){let i=P(("string"===typeof t?d(t):t).pathname||"/",n);if(null==i)return null;let s=g(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(s);let o=null;for(let a=0;null==o&&a<s.length;++a){let e=R(i);o=S(s[a],e,r)}return o}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=(e,i,s)=>{let o={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};o.relativePath.startsWith("/")&&(a(o.relativePath.startsWith(r),`Absolute route path "${o.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),o.relativePath=o.relativePath.slice(r.length));let l=D([r,o.relativePath]),c=n.concat(o);e.children&&e.children.length>0&&(a(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),g(e.children,t,c,l)),(null!=e.path||e.index)&&t.push({path:l,score:T(l,e.index),routesMeta:c})};return e.forEach(((e,t)=>{if(""!==e.path&&e.path?.includes("?"))for(let n of _(e.path))i(e,t,n);else i(e,t)})),t}function _(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===r.length)return i?[s,""]:[s];let o=_(r.join("/")),a=[];return a.push(...o.map((e=>""===e?s:[s,e].join("/")))),i&&a.push(...o),a.map((t=>e.startsWith("/")&&""===t?"/":t))}var v=/^:[\w-]+$/,y=3,w=2,C=1,b=10,I=-2,E=e=>"*"===e;function T(e,t){let n=e.split("/"),r=n.length;return n.some(E)&&(r+=I),t&&(r+=w),n.filter((e=>!E(e))).reduce(((e,t)=>e+(v.test(t)?y:""===t?C:b)),r)}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:r}=e,i={},s="/",o=[];for(let a=0;a<r.length;++a){let e=r[a],l=a===r.length-1,c="/"===s?t:t.slice(s.length)||"/",h=k({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!h&&l&&n&&!r[r.length-1].route.index&&(h=k({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:D([s,h.pathname]),pathnameBase:L(D([s,h.pathnameBase])),route:u}),"/"!==h.pathnameBase&&(s=D([s,h.pathnameBase]))}return o}function k(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];l("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let s=new RegExp(i,t?void 0:"i");return[s,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=a[n]||"";o=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:s,pathnameBase:o,pattern:e}}function R(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(ma){return l(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${ma}).`),e}}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function N(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function O(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function A(e){let t=O(e);return t.map(((e,n)=>n===t.length-1?e.pathname:e.pathnameBase))}function x(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?r=d(e):(r={...e},a(!r.pathname||!r.pathname.includes("?"),N("?","pathname","search",r)),a(!r.pathname||!r.pathname.includes("#"),N("#","pathname","hash",r)),a(!r.search||!r.search.includes("#"),N("#","search","hash",r)));let s,o=""===e||""===r.pathname,l=o?"/":r.pathname;if(null==l)s=n;else{let e=t.length-1;if(!i&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}s=e>=0?t[e]:"/"}let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:r="",hash:i=""}="string"===typeof e?d(e):e,s=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:s,search:M(r),hash:F(i)}}(r,s),h=l&&"/"!==l&&l.endsWith("/"),u=(o||"."===l)&&n.endsWith("/");return c.pathname.endsWith("/")||!h&&!u||(c.pathname+="/"),c}var D=e=>e.join("/").replace(/\/\/+/g,"/"),L=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),M=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function U(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var j=["POST","PUT","PATCH","DELETE"],$=(new Set(j),["GET",...j]);new Set($),Symbol("ResetLoaderData");var H=r.createContext(null);H.displayName="DataRouter";var W=r.createContext(null);W.displayName="DataRouterState";var q=r.createContext({isTransitioning:!1});q.displayName="ViewTransition";var V=r.createContext(new Map);V.displayName="Fetchers";var B=r.createContext(null);B.displayName="Await";var z=r.createContext(null);z.displayName="Navigation";var K=r.createContext(null);K.displayName="Location";var G=r.createContext({outlet:null,matches:[],isDataRoute:!1});G.displayName="Route";var Y=r.createContext(null);Y.displayName="RouteError";function J(){return null!=r.useContext(K)}function Q(){return a(J(),"useLocation() may be used only in the context of a <Router> component."),r.useContext(K).location}var X="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Z(e){r.useContext(z).static||r.useLayoutEffect(e)}function ee(){let{isDataRoute:e}=r.useContext(G);return e?function(){let{router:e}=ce("useNavigate"),t=ue("useNavigate"),n=r.useRef(!1);Z((()=>{n.current=!0}));let i=r.useCallback((async function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(n.current,X),n.current&&("number"===typeof r?e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))}),[e,t]);return i}():function(){a(J(),"useNavigate() may be used only in the context of a <Router> component.");let e=r.useContext(H),{basename:t,navigator:n}=r.useContext(z),{matches:i}=r.useContext(G),{pathname:s}=Q(),o=JSON.stringify(A(i)),c=r.useRef(!1);Z((()=>{c.current=!0}));let h=r.useCallback((function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(l(c.current,X),!c.current)return;if("number"===typeof r)return void n.go(r);let a=x(r,JSON.parse(o),s,"path"===i.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:D([t,a.pathname])),(i.replace?n.replace:n.push)(a,i.state,i)}),[t,n,o,s,e]);return h}()}r.createContext(null);function te(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:n}=r.useContext(G),{pathname:i}=Q(),s=JSON.stringify(A(n));return r.useMemo((()=>x(e,JSON.parse(s),i,"path"===t)),[e,s,i,t])}function ne(e,t,n,i){a(J(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s,static:o}=r.useContext(z),{matches:c}=r.useContext(G),h=c[c.length-1],u=h?h.params:{},p=h?h.pathname:"/",m=h?h.pathnameBase:"/",g=h&&h.route;{let e=g&&g.path||"";fe(p,!g||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let _,v=Q();if(t){let e="string"===typeof t?d(t):t;a("/"===m||e.pathname?.startsWith(m),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${e.pathname}" was given in the \`location\` prop.`),_=e}else _=v;let y=_.pathname||"/",w=y;if("/"!==m){let e=m.replace(/^\//,"").split("/");w="/"+y.replace(/^\//,"").split("/").slice(e.length).join("/")}let C=!o&&n&&n.matches&&n.matches.length>0?n.matches:f(e,{pathname:w});l(g||null!=C,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),l(null==C||void 0!==C[C.length-1].route.element||void 0!==C[C.length-1].route.Component||void 0!==C[C.length-1].route.lazy,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=ae(C&&C.map((e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:D([m,s.encodeLocation?s.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?m:D([m,s.encodeLocation?s.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),c,n,i);return t&&b?r.createElement(K.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},b):b}function re(){let e=de(),t=U(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},o={padding:"2px 4px",backgroundColor:i},a=null;return console.error("Error handled by React Router default ErrorBoundary:",e),a=r.createElement(r.Fragment,null,r.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),r.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",r.createElement("code",{style:o},"ErrorBoundary")," or"," ",r.createElement("code",{style:o},"errorElement")," prop on your route.")),r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),n?r.createElement("pre",{style:s},n):null,a)}var ie=r.createElement(re,null),se=class extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?r.createElement(G.Provider,{value:this.props.routeContext},r.createElement(Y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function oe(e){let{routeContext:t,match:n,children:i}=e,s=r.useContext(H);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),r.createElement(G.Provider,{value:t},i)}function ae(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let i=e,s=n?.errors;if(null!=s){let e=i.findIndex((e=>e.route.id&&void 0!==s?.[e.route.id]));a(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,e+1))}let o=!1,l=-1;if(n)for(let r=0;r<i.length;r++){let e=i[r];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=r),e.route.id){let{loaderData:t,errors:r}=n,s=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!r||void 0===r[e.route.id]);if(e.route.lazy||s){o=!0,i=l>=0?i.slice(0,l+1):[i[0]];break}}}return i.reduceRight(((e,a,c)=>{let h,u=!1,d=null,p=null;n&&(h=s&&a.route.id?s[a.route.id]:void 0,d=a.route.errorElement||ie,o&&(l<0&&0===c?(fe("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,p=null):l===c&&(u=!0,p=a.route.hydrateFallbackElement||null)));let f=t.concat(i.slice(0,c+1)),m=()=>{let t;return t=h?d:u?p:a.route.Component?r.createElement(a.route.Component,null):a.route.element?a.route.element:e,r.createElement(oe,{match:a,routeContext:{outlet:e,matches:f,isDataRoute:null!=n},children:t})};return n&&(a.route.ErrorBoundary||a.route.errorElement||0===c)?r.createElement(se,{location:n.location,revalidation:n.revalidation,component:d,error:h,children:m(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):m()}),null)}function le(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ce(e){let t=r.useContext(H);return a(t,le(e)),t}function he(e){let t=r.useContext(W);return a(t,le(e)),t}function ue(e){let t=function(e){let t=r.useContext(G);return a(t,le(e)),t}(e),n=t.matches[t.matches.length-1];return a(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function de(){let e=r.useContext(Y),t=he("useRouteError"),n=ue("useRouteError");return void 0!==e?e:t.errors?.[n]}var pe={};function fe(e,t,n){t||pe[e]||(pe[e]=!0,l(!1,n))}r.memo((function(e){let{routes:t,future:n,state:r}=e;return ne(t,void 0,r,n)}));function me(e){a(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ge(e){let{basename:t="/",children:n=null,location:i,navigationType:s="POP",navigator:o,static:c=!1}=e;a(!J(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=t.replace(/^\/*/,"/"),u=r.useMemo((()=>({basename:h,navigator:o,static:c,future:{}})),[h,o,c]);"string"===typeof i&&(i=d(i));let{pathname:p="/",search:f="",hash:m="",state:g=null,key:_="default"}=i,v=r.useMemo((()=>{let e=P(p,h);return null==e?null:{location:{pathname:e,search:f,hash:m,state:g,key:_},navigationType:s}}),[h,p,f,m,g,_,s]);return l(null!=v,`<Router basename="${h}"> is not able to match the URL "${p}${f}${m}" because it does not start with the basename, so the <Router> won't render anything.`),null==v?null:r.createElement(z.Provider,{value:u},r.createElement(K.Provider,{children:n,value:v}))}function _e(e){let{children:t,location:n}=e;return ne(ve(t),n)}r.Component;function ve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return r.Children.forEach(e,((e,i)=>{if(!r.isValidElement(e))return;let s=[...t,i];if(e.type===r.Fragment)return void n.push.apply(n,ve(e.props.children,s));a(e.type===me,`[${"string"===typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),a(!e.props.index||!e.props.children,"An index route cannot have child routes.");let o={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=ve(e.props.children,s)),n.push(o)})),n}var ye="get",we="application/x-www-form-urlencoded";function Ce(e){return null!=e&&"string"===typeof e.tagName}var be=null;var Ie=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ee(e){return null==e||Ie.has(e)?e:(l(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${we}"`),null)}function Te(e,t){let n,r,i,s,o;if(Ce(a=e)&&"form"===a.tagName.toLowerCase()){let o=e.getAttribute("action");r=o?P(o,t):null,n=e.getAttribute("method")||ye,i=Ee(e.getAttribute("enctype"))||we,s=new FormData(e)}else if(function(e){return Ce(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Ce(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let o=e.form;if(null==o)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=e.getAttribute("formaction")||o.getAttribute("action");if(r=a?P(a,t):null,n=e.getAttribute("formmethod")||o.getAttribute("method")||ye,i=Ee(e.getAttribute("formenctype"))||Ee(o.getAttribute("enctype"))||we,s=new FormData(o,e),!function(){if(null===be)try{new FormData(document.createElement("form"),0),be=!1}catch(e){be=!0}return be}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?`${t}.`:"";s.append(`${e}x`,"0"),s.append(`${e}y`,"0")}else t&&s.append(t,r)}}else{if(Ce(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=ye,r=null,i=we,o=e}var a;return s&&"text/plain"===i&&(o=s,s=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:s,body:o}}function Se(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}async function ke(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(ma){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(ma),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise((()=>{}))}}function Re(e){return null!=e&&"string"===typeof e.page}function Pe(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function Ne(e,t,n,r,i,s){let o=(e,t)=>!n[t]||e.route.id!==n[t].route.id,a=(e,t)=>n[t].pathname!==e.pathname||n[t].route.path?.endsWith("*")&&n[t].params["*"]!==e.params["*"];return"assets"===s?t.filter(((e,t)=>o(e,t)||a(e,t))):"data"===s?t.filter(((t,s)=>{let l=r.routes[t.route.id];if(!l||!l.hasLoader)return!1;if(o(t,s)||a(t,s))return!0;if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0})):[]}function Oe(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=e.map((e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i})).flat(1),[...new Set(r)];var r}function Ae(e,t){let n=new Set,r=new Set(t);return e.reduce(((e,i)=>{if(t&&!Re(i)&&"script"===i.as&&i.href&&r.has(i.href))return e;let s=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(i));return n.has(s)||(n.add(s),e.push({key:s,link:i})),e}),[])}function xe(e){return{__html:e}}Symbol("SingleFetchRedirect");function De(e,t){let n="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===n.pathname?n.pathname="_root.data":t&&"/"===P(n.pathname,t)?n.pathname=`${t.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}r.Component;function Le(e){let{error:t,isOutsideRemixApp:n}=e;console.error(t);let i,s=r.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://remix.run/guides/errors for more information."\n        );\n      '}});if(U(t))return r.createElement(Me,{title:"Unhandled Thrown Response!"},r.createElement("h1",{style:{fontSize:"24px"}},t.status," ",t.statusText),s);if(t instanceof Error)i=t;else{let e=null==t?"Unknown Error":"object"===typeof t&&"toString"in t?t.toString():JSON.stringify(t);i=new Error(e)}return r.createElement(Me,{title:"Application Error!",isOutsideRemixApp:n},r.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),r.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},i.stack),s)}function Me(e){let{title:t,renderScripts:n,isOutsideRemixApp:i,children:s}=e,{routeModules:o}=He();return o.root?.Layout&&!i?s:r.createElement("html",{lang:"en"},r.createElement("head",null,r.createElement("meta",{charSet:"utf-8"}),r.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),r.createElement("title",null,t)),r.createElement("body",null,r.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},s,n?r.createElement(Ge,null):null)))}function Fe(e){return!0===e}function Ue(){let e=r.useContext(H);return Se(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function je(){let e=r.useContext(W);return Se(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var $e=r.createContext(void 0);function He(){let e=r.useContext($e);return Se(e,"You must render this element inside a <HydratedRouter> element"),e}function We(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function qe(e,t,n){if(n&&!Ke)return[e[0]];if(t){let n=e.findIndex((e=>void 0!==t[e.route.id]));return e.slice(0,n+1)}return e}function Ve(e){let{page:t,...n}=e,{router:i}=Ue(),s=r.useMemo((()=>f(i.routes,t,i.basename)),[i.routes,t,i.basename]);return s?r.createElement(ze,{page:t,matches:s,...n}):null}function Be(e){let{manifest:t,routeModules:n}=He(),[i,s]=r.useState([]);return r.useEffect((()=>{let r=!1;return async function(e,t,n){return Ae((await Promise.all(e.map((async e=>{let r=t.routes[e.route.id];if(r){let e=await ke(r,n);return e.links?e.links():[]}return[]})))).flat(1).filter(Pe).filter((e=>"stylesheet"===e.rel||"preload"===e.rel)).map((e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"})))}(e,t,n).then((e=>{r||s(e)})),()=>{r=!0}}),[e,t,n]),i}function ze(e){let{page:t,matches:n,...i}=e,s=Q(),{manifest:o,routeModules:a}=He(),{basename:l}=Ue(),{loaderData:c,matches:h}=je(),u=r.useMemo((()=>Ne(t,n,h,o,s,"data")),[t,n,h,o,s]),d=r.useMemo((()=>Ne(t,n,h,o,s,"assets")),[t,n,h,o,s]),p=r.useMemo((()=>{if(t===s.pathname+s.search+s.hash)return[];let e=new Set,r=!1;if(n.forEach((t=>{let n=o.routes[t.route.id];n&&n.hasLoader&&(!u.some((e=>e.route.id===t.route.id))&&t.route.id in c&&a[t.route.id]?.shouldRevalidate||n.hasClientLoader?r=!0:e.add(t.route.id))})),0===e.size)return[];let i=De(t,l);return r&&e.size>0&&i.searchParams.set("_routes",n.filter((t=>e.has(t.route.id))).map((e=>e.route.id)).join(",")),[i.pathname+i.search]}),[l,c,s,o,u,n,t,a]),f=r.useMemo((()=>Oe(d,o)),[d,o]),m=Be(d);return r.createElement(r.Fragment,null,p.map((e=>r.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...i}))),f.map((e=>r.createElement("link",{key:e,rel:"modulepreload",href:e,...i}))),m.map((e=>{let{key:t,link:n}=e;return r.createElement("link",{key:t,...n})})))}$e.displayName="FrameworkContext";var Ke=!1;function Ge(e){let{manifest:t,serverHandoffString:n,isSpaMode:i,ssr:s,renderMeta:o}=He(),{router:a,static:l,staticContext:c}=Ue(),{matches:h}=je(),u=Fe(s);o&&(o.didRenderScripts=!0);let d=qe(h,null,i);r.useEffect((()=>{Ke=!0}),[]);let p=r.useMemo((()=>{let i=c?`window.__reactRouterContext = ${n};window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());`:" ",s=l?`${t.hmr?.runtime?`import ${JSON.stringify(t.hmr.runtime)};`:""}${u?"":`import ${JSON.stringify(t.url)}`};\n${d.map(((e,n)=>{let r=`route${n}`,i=t.routes[e.route.id];Se(i,`Route ${e.route.id} not found in manifest`);let{clientActionModule:s,clientLoaderModule:o,hydrateFallbackModule:a,module:l}=i,c=[...s?[{module:s,varName:`${r}_clientAction`}]:[],...o?[{module:o,varName:`${r}_clientLoader`}]:[],...a?[{module:a,varName:`${r}_HydrateFallback`}]:[],{module:l,varName:`${r}_main`}];return 1===c.length?`import * as ${r} from ${JSON.stringify(l)};`:[c.map((e=>`import * as ${e.varName} from "${e.module}";`)).join("\n"),`const ${r} = {${c.map((e=>`...${e.varName}`)).join(",")}};`].join("\n")})).join("\n")}\n  ${u?`window.__reactRouterManifest = ${JSON.stringify(function(e,t){let n=new Set(t.state.matches.map((e=>e.route.id))),r=t.state.location.pathname.split("/").filter(Boolean),i=["/"];for(r.pop();r.length>0;)i.push(`/${r.join("/")}`),r.pop();i.forEach((e=>{let r=f(t.routes,e,t.basename);r&&r.forEach((e=>n.add(e.route.id)))}));let s=[...n].reduce(((t,n)=>Object.assign(t,{[n]:e.routes[n]})),{});return{...e,routes:s}}(t,a),null,2)};`:""}\n  window.__reactRouterRouteModules = {${d.map(((e,t)=>`${JSON.stringify(e.route.id)}:route${t}`)).join(",")}};\n\nimport(${JSON.stringify(t.entry.module)});`:" ";return r.createElement(r.Fragment,null,r.createElement("script",{...e,suppressHydrationWarning:!0,dangerouslySetInnerHTML:xe(i),type:void 0}),r.createElement("script",{...e,suppressHydrationWarning:!0,dangerouslySetInnerHTML:xe(s),type:"module",async:!0}))}),[]),m=Ke?[]:t.entry.imports.concat(Oe(d,t,{includeHydrateFallback:!0}));return Ke?null:r.createElement(r.Fragment,null,u?null:r.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin}),r.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin}),(g=m,[...new Set(g)]).map((t=>r.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin}))),p);var g}function Ye(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach((t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)}))}}var Je="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{Je&&(window.__reactRouterVersion="7.4.0")}catch(tp){}function Qe(e){let{basename:t,children:n,window:i}=e,s=r.useRef();null==s.current&&(s.current=o({window:i,v5Compat:!0}));let a=s.current,[l,c]=r.useState({action:a.action,location:a.location}),h=r.useCallback((e=>{r.startTransition((()=>c(e)))}),[c]);return r.useLayoutEffect((()=>a.listen(h)),[a,h]),r.createElement(ge,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:a})}var Xe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ze=r.forwardRef((function(e,t){let n,{onClick:i,discover:s="render",prefetch:o="none",relative:c,reloadDocument:h,replace:d,state:p,target:f,to:m,preventScrollReset:g,viewTransition:_,...v}=e,{basename:y}=r.useContext(z),w="string"===typeof m&&Xe.test(m),C=!1;if("string"===typeof m&&w&&(n=m,Je))try{let e=new URL(window.location.href),t=m.startsWith("//")?new URL(e.protocol+m):new URL(m),n=P(t.pathname,y);t.origin===e.origin&&null!=n?m=n+t.search+t.hash:C=!0}catch(tp){l(!1,`<Link to="${m}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let b=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(J(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=r.useContext(z),{hash:s,pathname:o,search:l}=te(e,{relative:t}),c=o;return"/"!==n&&(c="/"===o?n:D([n,o])),i.createHref({pathname:c,search:l,hash:s})}(m,{relative:c}),[I,E,T]=function(e,t){let n=r.useContext($e),[i,s]=r.useState(!1),[o,a]=r.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:h,onMouseLeave:u,onTouchStart:d}=t,p=r.useRef(null);r.useEffect((()=>{if("render"===e&&a(!0),"viewport"===e){let e=new IntersectionObserver((e=>{e.forEach((e=>{a(e.isIntersecting)}))}),{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}}),[e]),r.useEffect((()=>{if(i){let e=setTimeout((()=>{a(!0)}),100);return()=>{clearTimeout(e)}}}),[i]);let f=()=>{s(!0)},m=()=>{s(!1),a(!1)};return n?"intent"!==e?[o,p,{}]:[o,p,{onFocus:We(l,f),onBlur:We(c,m),onMouseEnter:We(h,f),onMouseLeave:We(u,m),onTouchStart:We(d,f)}]:[!1,p,{}]}(o,v),S=function(e){let{target:t,replace:n,state:i,preventScrollReset:s,relative:o,viewTransition:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=ee(),c=Q(),h=te(e,{relative:o});return r.useCallback((r=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(r,t)){r.preventDefault();let t=void 0!==n?n:u(c)===u(h);l(e,{replace:t,state:i,preventScrollReset:s,relative:o,viewTransition:a})}}),[c,l,h,n,i,t,e,s,o,a])}(m,{replace:d,state:p,target:f,preventScrollReset:g,relative:c,viewTransition:_});let k=r.createElement("a",{...v,...T,href:n||b,onClick:C||h?i:function(e){i&&i(e),e.defaultPrevented||S(e)},ref:Ye(t,E),target:f,"data-discover":w||"render"!==s?void 0:"true"});return I&&!w?r.createElement(r.Fragment,null,k,r.createElement(Ve,{page:b})):k}));Ze.displayName="Link";var et=r.forwardRef((function(e,t){let{"aria-current":n="page",caseSensitive:i=!1,className:s="",end:o=!1,style:l,to:c,viewTransition:h,children:u,...d}=e,p=te(c,{relative:d.relative}),f=Q(),m=r.useContext(W),{navigator:g,basename:_}=r.useContext(z),v=null!=m&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.useContext(q);a(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=rt("useViewTransitionState"),s=te(e,{relative:t.relative});if(!n.isTransitioning)return!1;let o=P(n.currentLocation.pathname,i)||n.currentLocation.pathname,l=P(n.nextLocation.pathname,i)||n.nextLocation.pathname;return null!=k(s.pathname,l)||null!=k(s.pathname,o)}(p)&&!0===h,y=g.encodeLocation?g.encodeLocation(p).pathname:p.pathname,w=f.pathname,C=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;i||(w=w.toLowerCase(),C=C?C.toLowerCase():null,y=y.toLowerCase()),C&&_&&(C=P(C,_)||C);const b="/"!==y&&y.endsWith("/")?y.length-1:y.length;let I,E=w===y||!o&&w.startsWith(y)&&"/"===w.charAt(b),T=null!=C&&(C===y||!o&&C.startsWith(y)&&"/"===C.charAt(y.length)),S={isActive:E,isPending:T,isTransitioning:v},R=E?n:void 0;I="function"===typeof s?s(S):[s,E?"active":null,T?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let N="function"===typeof l?l(S):l;return r.createElement(Ze,{...d,"aria-current":R,className:I,ref:t,style:N,to:c,viewTransition:h},"function"===typeof u?u(S):u)}));et.displayName="NavLink";var tt=r.forwardRef(((e,t)=>{let{discover:n="render",fetcherKey:i,navigate:s,reloadDocument:o,replace:l,state:c,method:h=ye,action:d,onSubmit:p,relative:f,preventScrollReset:m,viewTransition:g,..._}=e,v=ot(),y=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:n}=r.useContext(z),i=r.useContext(G);a(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),o={...te(e||".",{relative:t})},l=Q();if(null==e){o.search=l.search;let e=new URLSearchParams(o.search),t=e.getAll("index");if(t.some((e=>""===e))){e.delete("index"),t.filter((e=>e)).forEach((t=>e.append("index",t)));let n=e.toString();o.search=n?`?${n}`:""}}e&&"."!==e||!s.route.index||(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(o.pathname="/"===o.pathname?n:D([n,o.pathname]));return u(o)}(d,{relative:f}),w="get"===h.toLowerCase()?"get":"post",C="string"===typeof d&&Xe.test(d);return r.createElement("form",{ref:t,method:w,action:y,onSubmit:o?p:e=>{if(p&&p(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=t?.getAttribute("formmethod")||h;v(t||e.currentTarget,{fetcherKey:i,method:n,navigate:s,replace:l,state:c,relative:f,preventScrollReset:m,viewTransition:g})},..._,"data-discover":C||"render"!==n?void 0:"true"})}));function nt(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rt(e){let t=r.useContext(H);return a(t,nt(e)),t}tt.displayName="Form";var it=0,st=()=>`__${String(++it)}__`;function ot(){let{router:e}=rt("useSubmit"),{basename:t}=r.useContext(z),n=ue("useRouteId");return r.useCallback((async function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:s,method:o,encType:a,formData:l,body:c}=Te(r,t);if(!1===i.navigate){let t=i.fetcherKey||st();await e.fetch(t,n,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await e.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})}),[e,t,n])}new TextEncoder;const at=!1,lt=!1,ct="${JSCORE_VERSION}",ht=function(e,t){if(!e)throw ut(t)},ut=function(e){return new Error("Firebase Database ("+ct+") INTERNAL ASSERT FAILED: "+e)},dt=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},pt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0,c=t>>2,h=(3&t)<<4|o>>4;let u=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(u=64)),r.push(n[c],n[h],n[u],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(dt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw new ft;const l=t<<2|s>>4;if(r.push(l),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class ft extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mt=function(e){const t=dt(e);return pt.encodeByteArray(t,!0)},gt=function(e){return mt(e).replace(/\./g,"")},_t=function(e){try{return pt.decodeString(e,!0)}catch(tp){console.error("base64Decode failed: ",tp)}return null};function vt(e){return yt(void 0,e)}function yt(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=yt(e[n],t[n]));return e}const wt=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Ct=()=>{try{return wt()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/chatapp",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(tp){return}const t=e&&_t(e[1]);return t&&JSON.parse(t)})()}catch(tp){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${tp}`)}},bt=e=>{var t,n;return null===(n=null===(t=Ct())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},It=e=>{const t=bt(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},Et=()=>{var e;return null===(e=Ct())||void 0===e?void 0:e.config},Tt=e=>{var t;return null===(t=Ct())||void 0===t?void 0:t[`_${e}`]};class St{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function kt(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[gt(JSON.stringify({alg:"none",type:"JWT"})),gt(JSON.stringify(s)),""].join(".")}function Rt(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Pt(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Rt())}function Nt(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function Ot(){return!0===at||!0===lt}class At extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,At.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xt.prototype.create)}}class xt{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(Dt,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(r,t):"Error",s=`${this.serviceName}: ${i} (${n}).`;return new At(n,s,t)}}const Dt=/\{\$([^}]+)}/g;function Lt(e){return JSON.parse(e)}function Mt(e){return JSON.stringify(e)}const Ft=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=Lt(_t(s[0])||""),n=Lt(_t(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(tp){}return{header:t,claims:n,data:r,signature:i}};function Ut(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function jt(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function $t(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ht(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function Wt(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(qt(n)&&qt(s)){if(!Wt(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function qt(e){return null!==e&&"object"===typeof e}function Vt(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Bt(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function zt(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Kt{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let h=0;h<16;h++)n[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)n[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const e=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let h=0;h<80;h++){h<40?h<20?(r=l^o&(a^l),i=1518500249):(r=o^a^l,i=1859775393):h<60?(r=o&a|l&(o|a),i=2400959708):(r=o^a^l,i=3395469782);const e=(s<<5|s>>>27)+r+c+i+n[h]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class Gt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Yt),void 0===r.error&&(r.error=Yt),void 0===r.complete&&(r.complete=Yt);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(tp){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(tp){"undefined"!==typeof console&&console.error&&console.error(tp)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Yt(){}function Jt(e,t){return`${e} failed: ${t} argument `}const Qt=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function Xt(e){return e&&e._delegate?e._delegate:e}class Zt{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const en="[DEFAULT]";class tn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new St;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(tp){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(tp){if(r)return null;throw tp}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:en})}catch(tp){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(tp){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===en?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(s){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return this.component?this.component.multipleInstances?e:en:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class nn{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new tn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const rn=[];var sn;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(sn||(sn={}));const on={debug:sn.DEBUG,verbose:sn.VERBOSE,info:sn.INFO,warn:sn.WARN,error:sn.ERROR,silent:sn.SILENT},an=sn.INFO,ln={[sn.DEBUG]:"log",[sn.VERBOSE]:"log",[sn.INFO]:"info",[sn.WARN]:"warn",[sn.ERROR]:"error"},cn=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=ln[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];console[r](`[${n}]  ${e.name}:`,...s)};class hn{constructor(e){this.name=e,this._logLevel=an,this._logHandler=cn,this._userLogHandler=null,rn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in sn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?on[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,sn.DEBUG,...t),this._logHandler(this,sn.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,sn.VERBOSE,...t),this._logHandler(this,sn.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,sn.INFO,...t),this._logHandler(this,sn.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,sn.WARN,...t),this._logHandler(this,sn.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,sn.ERROR,...t),this._logHandler(this,sn.ERROR,...t)}}let un,dn;const pn=new WeakMap,fn=new WeakMap,mn=new WeakMap,gn=new WeakMap,_n=new WeakMap;let vn={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return fn.get(e);if("objectStoreNames"===t)return e.objectStoreNames||mn.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Cn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function yn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(dn||(dn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(bn(this),n),Cn(pn.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Cn(e.apply(bn(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=e.call(bn(this),t,...r);return mn.set(s,t.sort?t.sort():[t]),Cn(s)}}function wn(e){return"function"===typeof e?yn(e):(e instanceof IDBTransaction&&function(e){if(fn.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));fn.set(e,t)}(e),t=e,(un||(un=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,vn):e);var t}function Cn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Cn(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&pn.set(t,e)})).catch((()=>{})),_n.set(t,e),t}(e);if(gn.has(e))return gn.get(e);const t=wn(e);return t!==e&&(gn.set(e,t),_n.set(t,e)),t}const bn=e=>_n.get(e);const In=["get","getKey","getAll","getAllKeys","count"],En=["put","add","delete","clear"],Tn=new Map;function Sn(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Tn.get(t))return Tn.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=En.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!In.includes(n))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return r&&(s=s.index(a.shift())),(await Promise.all([s[n](...a),i&&t.done]))[0]};return Tn.set(t,s),s}vn=(e=>({...e,get:(t,n,r)=>Sn(t,n)||e.get(t,n,r),has:(t,n)=>!!Sn(t,n)||e.has(t,n)}))(vn);class kn{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Rn="@firebase/app",Pn="0.11.2",Nn=new hn("@firebase/app"),On="@firebase/app-compat",An="@firebase/analytics-compat",xn="@firebase/analytics",Dn="@firebase/app-check-compat",Ln="@firebase/app-check",Mn="@firebase/auth",Fn="@firebase/auth-compat",Un="@firebase/database",jn="@firebase/data-connect",$n="@firebase/database-compat",Hn="@firebase/functions",Wn="@firebase/functions-compat",qn="@firebase/installations",Vn="@firebase/installations-compat",Bn="@firebase/messaging",zn="@firebase/messaging-compat",Kn="@firebase/performance",Gn="@firebase/performance-compat",Yn="@firebase/remote-config",Jn="@firebase/remote-config-compat",Qn="@firebase/storage",Xn="@firebase/storage-compat",Zn="@firebase/firestore",er="@firebase/vertexai",tr="@firebase/firestore-compat",nr="firebase",rr="[DEFAULT]",ir={[Rn]:"fire-core",[On]:"fire-core-compat",[xn]:"fire-analytics",[An]:"fire-analytics-compat",[Ln]:"fire-app-check",[Dn]:"fire-app-check-compat",[Mn]:"fire-auth",[Fn]:"fire-auth-compat",[Un]:"fire-rtdb",[jn]:"fire-data-connect",[$n]:"fire-rtdb-compat",[Hn]:"fire-fn",[Wn]:"fire-fn-compat",[qn]:"fire-iid",[Vn]:"fire-iid-compat",[Bn]:"fire-fcm",[zn]:"fire-fcm-compat",[Kn]:"fire-perf",[Gn]:"fire-perf-compat",[Yn]:"fire-rc",[Jn]:"fire-rc-compat",[Qn]:"fire-gcs",[Xn]:"fire-gcs-compat",[Zn]:"fire-fst",[tr]:"fire-fst-compat",[er]:"fire-vertex","fire-js":"fire-js",[nr]:"fire-js-all"},sr=new Map,or=new Map,ar=new Map;function lr(e,t){try{e.container.addComponent(t)}catch(tp){Nn.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,tp)}}function cr(e){const t=e.name;if(ar.has(t))return Nn.debug(`There were multiple attempts to register component ${t}.`),!1;ar.set(t,e);for(const n of sr.values())lr(n,e);for(const n of or.values())lr(n,e);return!0}function hr(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ur(e){return null!==e&&void 0!==e&&void 0!==e.settings}const dr=new xt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class pr{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Zt("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw dr.create("app-deleted",{appName:this._name})}}const fr="11.4.0";function mr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:rr,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw dr.create("bad-app-name",{appName:String(i)});if(n||(n=Et()),!n)throw dr.create("no-options");const s=sr.get(i);if(s){if(Wt(n,s.options)&&Wt(r,s.config))return s;throw dr.create("duplicate-app",{appName:i})}const o=new nn(i);for(const l of ar.values())o.addComponent(l);const a=new pr(n,r,o);return sr.set(i,a),a}function gr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rr;const t=sr.get(e);if(!t&&e===rr&&Et())return mr();if(!t)throw dr.create("no-app",{appName:e});return t}function _r(e,t,n){var r;let i=null!==(r=ir[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Nn.warn(e.join(" "))}cr(new Zt(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const vr="firebase-heartbeat-store";let yr=null;function wr(){return yr||(yr=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=Cn(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Cn(o.result),e.oldVersion,e.newVersion,Cn(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(vr)}catch(tp){console.warn(tp)}}}).catch((e=>{throw dr.create("idb-open",{originalErrorMessage:e.message})}))),yr}async function Cr(e,t){try{const n=(await wr()).transaction(vr,"readwrite"),r=n.objectStore(vr);await r.put(t,br(e)),await n.done}catch(tp){if(tp instanceof At)Nn.warn(tp.message);else{const t=dr.create("idb-set",{originalErrorMessage:null===tp||void 0===tp?void 0:tp.message});Nn.warn(t.message)}}}function br(e){return`${e.name}!${e.options.appId}`}class Ir{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Tr(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Er();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(tp){Nn.warn(tp)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Er(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Sr(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Sr(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=gt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(tp){return Nn.warn(tp),""}}}function Er(){return(new Date).toISOString().substring(0,10)}class Tr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"===typeof indexedDB}catch(tp){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(ma){t(ma)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await wr()).transaction(vr),n=await t.objectStore(vr).get(br(e));return await t.done,n}catch(tp){if(tp instanceof At)Nn.warn(tp.message);else{const t=dr.create("idb-get",{originalErrorMessage:null===tp||void 0===tp?void 0:tp.message});Nn.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Cr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Cr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Sr(e){return gt(JSON.stringify({version:2,heartbeats:e})).length}var kr;kr="",cr(new Zt("platform-logger",(e=>new kn(e)),"PRIVATE")),cr(new Zt("heartbeat",(e=>new Ir(e)),"PRIVATE")),_r(Rn,Pn,kr),_r(Rn,Pn,"esm2017"),_r("fire-js","");_r("firebase","11.4.0","app");function Rr(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function Pr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nr=Pr,Or=new xt("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ar=new hn("@firebase/auth");function xr(e){if(Ar.logLevel<=sn.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Ar.error(`Auth (${fr}): ${e}`,...n)}}function Dr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw jr(e,...n)}function Lr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return jr(e,...n)}function Mr(e,t,n){const r=Object.assign(Object.assign({},Nr()),{[t]:n});return new xt("auth","Firebase",r).create(t,{appName:e.name})}function Fr(e){return Mr(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ur(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Dr(e,"argument-error"),Mr(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function jr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return Or.create(e,...n)}function $r(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw jr(t,...r)}}function Hr(e){const t="INTERNAL ASSERTION FAILED: "+e;throw xr(t),new Error(t)}function Wr(e,t){e||Hr(t)}function qr(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Vr(){return"http:"===Br()||"https:"===Br()}function Br(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function zr(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Vr()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Kr{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wr(t>e,"Short delay should be less than long delay!"),this.isMobile=Pt()||Nt()}get(){return zr()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Gr(e,t){Wr(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Yr{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Hr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Hr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Hr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Jr={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Qr=new Kr(3e4,6e4);function Xr(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Zr(e,t,n,r){return ei(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=Vt(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:a},i);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),Yr.fetch()(ni(e,e.config.apiHost,n,o),l)}))}async function ei(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Jr),t);try{const t=new ii(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw si(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw si(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw si(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw si(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Mr(e,a,o);Dr(e,a)}}catch(tp){if(tp instanceof At)throw tp;Dr(e,"network-request-failed",{message:String(tp)})}}async function ti(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=await Zr(e,t,n,r,i);return"mfaPendingCredential"in s&&Dr(e,"multi-factor-auth-required",{_serverResponse:s}),s}function ni(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Gr(e.config,i):`${e.config.apiScheme}://${i}`}function ri(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ii{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Lr(this.auth,"network-request-failed"))),Qr.get())}))}}function si(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Lr(e,t,r);return i.customData._tokenResponse=n,i}function oi(e){return void 0!==e&&void 0!==e.enterprise}class ai{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return ri(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function li(e,t){return Zr(e,"GET","/v2/recaptchaConfig",Xr(e,t))}async function ci(e,t){return Zr(e,"POST","/v1/accounts:lookup",t)}function hi(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(tp){}}function ui(e){return 1e3*Number(e)}function di(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return xr("JWT malformed, contained fewer than 3 sections"),null;try{const e=_t(n);return e?JSON.parse(e):(xr("Failed to decode base64 JWT payload"),null)}catch(tp){return xr("Caught error parsing JWT payload as JSON",null===tp||void 0===tp?void 0:tp.toString()),null}}function pi(e){const t=di(e);return $r(t,"internal-error"),$r("undefined"!==typeof t.exp,"internal-error"),$r("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function fi(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(tp){throw tp instanceof At&&function(e){let{code:t}=e;return"auth/user-disabled"===t||"auth/user-token-expired"===t}(tp)&&e.auth.currentUser===e&&await e.auth.signOut(),tp}}class mi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(tp){return void("auth/network-request-failed"===(null===tp||void 0===tp?void 0:tp.code)&&this.schedule(!0))}this.schedule()}}class gi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=hi(this.lastLoginAt),this.creationTime=hi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function _i(e){var t;const n=e.auth,r=await e.getIdToken(),i=await fi(e,ci(n,{idToken:r}));$r(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?vi(s.providerUserInfo):[],a=(l=e.providerData,c=o,[...l.filter((e=>!c.some((t=>t.providerId===e.providerId)))),...c]);var l,c;const h=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null===a||void 0===a?void 0:a.length),d=!!h&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new gi(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function vi(e){return e.map((e=>{var{providerId:t}=e,n=Rr(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class yi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$r(e.idToken,"internal-error"),$r("undefined"!==typeof e.idToken,"internal-error"),$r("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):pi(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$r(0!==e.length,"internal-error");const t=pi(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?($r(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await ei(e,{},(async()=>{const n=Vt({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=ni(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Yr.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new yi;return n&&($r("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&($r("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&($r("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yi,this.toJSON())}_performRefresh(){return Hr("not implemented")}}function wi(e,t){$r("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Ci{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Rr(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new mi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new gi(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await fi(this,this.stsTokenManager.getToken(this.auth,e));return $r(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Xt(e),r=await n.getIdToken(t),i=di(r);$r(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"===typeof i.firebase?i.firebase:void 0,o=null===s||void 0===s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:hi(ui(i.auth_time)),issuedAtTime:hi(ui(i.iat)),expirationTime:hi(ui(i.exp)),signInProvider:o||null,signInSecondFactor:(null===s||void 0===s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Xt(e);await _i(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&($r(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ci(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){$r(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await _i(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(Fr(this.auth));const e=await this.getIdToken();return await fi(this,async function(e,t){return Zr(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,l,c;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,_=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:y,isAnonymous:w,providerData:C,stsTokenManager:b}=t;$r(v&&b,e,"internal-error");const I=yi.fromJSON(this.name,b);$r("string"===typeof v,e,"internal-error"),wi(h,e.name),wi(u,e.name),$r("boolean"===typeof y,e,"internal-error"),$r("boolean"===typeof w,e,"internal-error"),wi(d,e.name),wi(p,e.name),wi(f,e.name),wi(m,e.name),wi(g,e.name),wi(_,e.name);const E=new Ci({uid:v,auth:e,email:u,emailVerified:y,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:I,createdAt:g,lastLoginAt:_});return C&&Array.isArray(C)&&(E.providerData=C.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new yi;r.updateFromServerResponse(t);const i=new Ci({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await _i(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];$r(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?vi(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),o=new yi;o.updateFromIdToken(n);const a=new Ci({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new gi(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(a,l),a}}const bi=new Map;function Ii(e){Wr(e instanceof Function,"Expected a class definition");let t=bi.get(e);return t?(Wr(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,bi.set(e,t),t)}class Ei{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ei.type="NONE";const Ti=Ei;function Si(e,t,n){return`firebase:${e}:${t}:${n}`}class ki{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Si(this.userKey,r.apiKey,i),this.fullPersistenceKey=Si("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ci._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new ki(Ii(Ti),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Ii(Ti);const s=Si(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(s);if(t){const n=Ci._fromJSON(e,t);c!==i&&(o=n),i=c;break}}catch(l){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(l){}}))),new ki(i,e,n)):new ki(i,e,n)}}function Ri(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ai(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Pi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Di(t))return"Blackberry";if(Li(t))return"Webos";if(Ni(t))return"Safari";if((t.includes("chrome/")||Oi(t))&&!t.includes("edge/"))return"Chrome";if(xi(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Pi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/firefox\//i.test(e)}function Ni(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Oi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/crios\//i.test(e)}function Ai(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/iemobile/i.test(e)}function xi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/android/i.test(e)}function Di(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/blackberry/i.test(e)}function Li(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/webos/i.test(e)}function Mi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Fi(){return function(){const e=Rt();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Ui(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return Mi(e)||xi(e)||Li(e)||Di(e)||/windows phone/i.test(e)||Ai(e)}function ji(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Ri(Rt());break;case"Worker":t=`${Ri(Rt())}-${e}`;break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return`${t}/JsCore/${fr}/${r}`}class $i{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(tp){r(tp)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(tp){t.reverse();for(const r of t)try{r()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===tp||void 0===tp?void 0:tp.message})}}}class Hi{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Wi{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Vi(this),this.idTokenSubscription=new Vi(this),this.beforeStateQueue=new $i(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Or,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ii(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ki.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(tp){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await ci(this,{idToken:e}),n=await Ci._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ur(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null===r||void 0===r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null===o||void 0===o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(tp){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(tp)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return $r(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(tp){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _i(e)}catch(tp){if("auth/network-request-failed"!==(null===tp||void 0===tp?void 0:tp.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(Fr(this));const t=e?Xt(e):null;return t&&$r(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&$r(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return ur(this.app)?Promise.reject(Fr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(Fr(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Ii(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Zr(e,"GET","/v2/passwordPolicy",Xr(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new Hi(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new xt("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Zr(e,"POST","/v2/accounts:revokeToken",Xr(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ii(e)||this._popupRedirectResolver;$r(t,this,"argument-error"),this.redirectPersistenceManager=await ki.create(this,[Ii(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if($r(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $r(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ji(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Ar.logLevel<=sn.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Ar.warn(`Auth (${fr}): ${e}`,...n)}}(`Error while retrieving App Check token: ${t.error}`),null===t||void 0===t?void 0:t.token}}function qi(e){return Xt(e)}class Vi{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Gt(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return $r(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Bi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zi(e){return Bi.loadJS(e)}function Ki(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Gi{constructor(){this.enterprise=new Yi}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Yi{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Ji="NO_RECAPTCHA";class Qi{constructor(e){this.type="recaptcha-enterprise",this.auth=qi(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;oi(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(Ji)}))})):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Gi).execute("siteKey",{action:"verify"})}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{li(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new ai(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&oi(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Bi.recaptchaEnterpriseScript;0!==t.length&&(t+=i),zi(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Xi(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=new Qi(e);let o;if(i)o=Ji;else try{o=await s.verify(n)}catch(ma){o=await s.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Zi(e,t,n,r,i){var s,o;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Xi(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await Xi(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}if("PHONE_PROVIDER"===i){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const i=await Xi(e,t,n);return r(e,i).catch((async i=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await Xi(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)}))}{const i=await Xi(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function es(e){const t=qi(e),n=await li(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new ai(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new Qi(t).verify()}}function ts(e,t,n){const r=qi(e);$r(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),s=ns(t),{host:o,port:a}=function(e){const t=ns(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:rs(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:rs(t)}}}(t),l={url:`${s}//${o}${null===a?"":`:${a}`}/`},c=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return $r(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void $r(Wt(l,r.config.emulator)&&Wt(c,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=l,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ns(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rs(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class is{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Hr("not implemented")}_getIdTokenResponse(e){return Hr("not implemented")}_linkToIdToken(e,t){return Hr("not implemented")}_getReauthenticationResolver(e){return Hr("not implemented")}}async function ss(e,t){return Zr(e,"POST","/v1/accounts:signUp",t)}async function os(e,t){return ti(e,"POST","/v1/accounts:signInWithPassword",Xr(e,t))}class as extends is{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new as(e,t,"password")}static _fromEmailAndCode(e,t){return new as(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Zi(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",os,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return ti(e,"POST","/v1/accounts:signInWithEmailLink",Xr(e,t))}(e,{email:this._email,oobCode:this._password});default:Dr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Zi(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ss,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return ti(e,"POST","/v1/accounts:signInWithEmailLink",Xr(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Dr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ls(e,t){return ti(e,"POST","/v1/accounts:signInWithIdp",Xr(e,t))}class cs extends is{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new cs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Dr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Rr(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new cs(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return ls(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ls(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ls(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Vt(t)}return e}}async function hs(e,t){return Zr(e,"POST","/v1/accounts:sendVerificationCode",Xr(e,t))}const us={USER_NOT_FOUND:"user-not-found"};class ds extends is{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ds({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ds({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ti(e,"POST","/v1/accounts:signInWithPhoneNumber",Xr(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ti(e,"POST","/v1/accounts:signInWithPhoneNumber",Xr(e,t));if(n.temporaryProof)throw si(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ti(e,"POST","/v1/accounts:signInWithPhoneNumber",Xr(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),us)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ds({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ps{constructor(e){var t,n,r,i,s,o;const a=Bt(zt(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);$r(l&&c&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=c,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=Bt(zt(e)).link,n=t?Bt(zt(t)).deep_link_id:null,r=Bt(zt(e)).deep_link_id;return(r?Bt(zt(r)).link:null)||r||n||t||e}(e);try{return new ps(t)}catch(n){return null}}}class fs{constructor(){this.providerId=fs.PROVIDER_ID}static credential(e,t){return as._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ps.parseLink(t);return $r(n,"argument-error"),as._fromEmailAndCode(e,n.code,n.tenantId)}}fs.PROVIDER_ID="password",fs.EMAIL_PASSWORD_SIGN_IN_METHOD="password",fs.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ms{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class gs extends ms{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class _s extends gs{constructor(){super("facebook.com")}static credential(e){return cs._fromParams({providerId:_s.PROVIDER_ID,signInMethod:_s.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _s.credentialFromTaggedObject(e)}static credentialFromError(e){return _s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return _s.credential(t.oauthAccessToken)}catch(n){return null}}}_s.FACEBOOK_SIGN_IN_METHOD="facebook.com",_s.PROVIDER_ID="facebook.com";class vs extends gs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return cs._fromParams({providerId:vs.PROVIDER_ID,signInMethod:vs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return vs.credentialFromTaggedObject(e)}static credentialFromError(e){return vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return vs.credential(n,r)}catch(i){return null}}}vs.GOOGLE_SIGN_IN_METHOD="google.com",vs.PROVIDER_ID="google.com";class ys extends gs{constructor(){super("github.com")}static credential(e){return cs._fromParams({providerId:ys.PROVIDER_ID,signInMethod:ys.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ys.credentialFromTaggedObject(e)}static credentialFromError(e){return ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ys.credential(t.oauthAccessToken)}catch(n){return null}}}ys.GITHUB_SIGN_IN_METHOD="github.com",ys.PROVIDER_ID="github.com";class ws extends gs{constructor(){super("twitter.com")}static credential(e,t){return cs._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return ws.credential(n,r)}catch(i){return null}}}async function Cs(e,t){return ti(e,"POST","/v1/accounts:signUp",Xr(e,t))}ws.TWITTER_SIGN_IN_METHOD="twitter.com",ws.PROVIDER_ID="twitter.com";class bs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Ci._fromIdTokenResponse(e,n,r),s=Is(n);return new bs({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Is(n);return new bs({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Is(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Es extends At{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Es.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Es(e,t,n,r)}}function Ts(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Es._fromErrorAndOperation(e,n,t,r);throw n}))}async function Ss(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await fi(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return bs._forOperation(e,"link",r)}async function ks(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(ur(r.app))return Promise.reject(Fr(r));const i="reauthenticate";try{const s=await fi(e,Ts(r,i,t,e),n);$r(s.idToken,r,"internal-error");const o=di(s.idToken);$r(o,r,"internal-error");const{sub:a}=o;return $r(e.uid===a,r,"user-mismatch"),bs._forOperation(e,i,s)}catch(tp){throw"auth/user-not-found"===(null===tp||void 0===tp?void 0:tp.code)&&Dr(r,"user-mismatch"),tp}}async function Rs(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ur(e.app))return Promise.reject(Fr(e));const r="signIn",i=await Ts(e,r,t),s=await bs._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Ps(e,t){return Rs(qi(e),t)}async function Ns(e){const t=qi(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function Os(e,t){return Zr(e,"POST","/v2/accounts/mfaEnrollment:start",Xr(e,t))}new WeakMap;const As="__sak";class xs{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(As,"1"),this.storage.removeItem(As),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ds extends xs{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ui(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);Fi()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ds.type="LOCAL";const Ls=Ds;class Ms extends xs{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ms.type="SESSION";const Fs=Ms;class Us{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Us(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function js(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Us.receivers=[];class $s{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const l=js("",20);r.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(c),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Hs(){return window}function Ws(){return"undefined"!==typeof Hs().WorkerGlobalScope&&"function"===typeof Hs().importScripts}const qs="firebaseLocalStorageDb",Vs="firebaseLocalStorage",Bs="fbase_key";class zs{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ks(e,t){return e.transaction([Vs],t?"readwrite":"readonly").objectStore(Vs)}function Gs(){const e=indexedDB.open(qs,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Vs,{keyPath:Bs})}catch(tp){n(tp)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Vs)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(qs);return new zs(e).toPromise()}(),t(await Gs()))}))}))}async function Ys(e,t,n){const r=Ks(e,!0).put({[Bs]:t,value:n});return new zs(r).toPromise()}function Js(e,t){const n=Ks(e,!0).delete(t);return new zs(n).toPromise()}class Qs{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Gs()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(tp){if(t++>3)throw tp;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ws()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Us._getInstance(Ws()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new $s(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Gs();return await Ys(e,As,"1"),await Js(e,As),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Ys(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ks(e,!1).get(t),r=await new zs(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Js(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ks(e,!1).getAll();return new zs(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Qs.type="LOCAL";const Xs=Qs;function Zs(e,t){return Zr(e,"POST","/v2/accounts/mfaSignIn:start",Xr(e,t))}Ki("rcb"),new Kr(3e4,6e4);const eo="recaptcha";async function to(e,t,n){var r;if(!e._getRecaptchaConfig())try{await es(e)}catch(ma){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){$r("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=Zi(e,r,"mfaSmsEnrollment",(async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Ji){$r((null===n||void 0===n?void 0:n.type)===eo,e,"argument-error");return Os(e,await no(e,t,n))}return Os(e,t)}),"PHONE_PROVIDER"),o=await s.catch((e=>Promise.reject(e)));return o.phoneSessionInfo.sessionInfo}{$r("signin"===t.type,e,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;$r(s,e,"missing-multi-factor-info");const o={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=Zi(e,o,"mfaSmsSignIn",(async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Ji){$r((null===n||void 0===n?void 0:n.type)===eo,e,"argument-error");return Zs(e,await no(e,t,n))}return Zs(e,t)}),"PHONE_PROVIDER"),l=await a.catch((e=>Promise.reject(e)));return l.phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=Zi(e,t,"sendVerificationCode",(async(e,t)=>{if(t.captchaResponse===Ji){$r((null===n||void 0===n?void 0:n.type)===eo,e,"argument-error");return hs(e,await no(e,t,n))}return hs(e,t)}),"PHONE_PROVIDER"),s=await r.catch((e=>Promise.reject(e)));return s.sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function no(e,t,n){$r(n.type===eo,e,"argument-error");const r=await n.verify();$r("string"===typeof r,e,"argument-error");const i=Object.assign({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class ro{constructor(e){this.providerId=ro.PROVIDER_ID,this.auth=qi(e)}verifyPhoneNumber(e,t){return to(this.auth,e,Xt(t))}static credential(e,t){return ds._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ro.credentialFromTaggedObject(t)}static credentialFromError(e){return ro.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?ds._fromTokenResponse(n,r):null}}function io(e,t){return t?Ii(t):($r(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}ro.PROVIDER_ID="phone",ro.PHONE_SIGN_IN_METHOD="phone";class so extends is{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ls(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ls(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ls(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function oo(e){return Rs(e.auth,new so(e),e.bypassAuthState)}function ao(e){const{auth:t,user:n}=e;return $r(n,t,"internal-error"),ks(n,new so(e),e.bypassAuthState)}async function lo(e){const{auth:t,user:n}=e;return $r(n,t,"internal-error"),Ss(n,new so(e),e.bypassAuthState)}class co{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(tp){this.reject(tp)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(tp){this.reject(tp)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oo;case"linkViaPopup":case"linkViaRedirect":return lo;case"reauthViaPopup":case"reauthViaRedirect":return ao;default:Dr(this.auth,"internal-error")}}resolve(e){Wr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ho=new Kr(2e3,1e4);class uo extends co{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,uo.currentPopupAction&&uo.currentPopupAction.cancel(),uo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $r(e,this.auth,"internal-error"),e}async onExecution(){Wr(1===this.filter.length,"Popup operations only handle one event");const e=js();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Lr(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Lr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,uo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Lr(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,ho.get())};e()}}uo.currentPopupAction=null;const po=new Map;class fo extends co{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=po.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=_o(t),r=go(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(tp){e=()=>Promise.reject(tp)}po.set(this.auth._key(),e)}return this.bypassAuthState||po.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function mo(e,t){po.set(e._key(),t)}function go(e){return Ii(e._redirectPersistence)}function _o(e){return Si("pendingRedirect",e.config.apiKey,e.name)}async function vo(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ur(e.app))return Promise.reject(Fr(e));const r=qi(e),i=io(r,t),s=new fo(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class yo{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Co(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Co(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Lr(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(wo(e))}saveEventToCache(e){this.cachedEventUids.add(wo(e)),this.lastProcessedEventTime=Date.now()}}function wo(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Co(e){let{type:t,error:n}=e;return"unknown"===t&&"auth/no-auth-event"===(null===n||void 0===n?void 0:n.code)}const bo=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Io=/^https?/;async function Eo(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Zr(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(To(r))return}catch(n){}Dr(e,"unauthorized-domain")}function To(e){const t=qr(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Io.test(n))return!1;if(bo.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const So=new Kr(3e4,6e4);function ko(){const e=Hs().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Ro(e){return new Promise(((t,n)=>{var r,i,s;function o(){ko(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ko(),n(Lr(e,"network-request-failed"))},timeout:So.get()})}if(null===(i=null===(r=Hs().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Hs().gapi)||void 0===s?void 0:s.load)){const t=Ki("iframefcb");return Hs()[t]=()=>{gapi.load?o():n(Lr(e,"network-request-failed"))},zi(`${Bi.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Po=null,e}))}let Po=null;const No=new Kr(5e3,15e3),Oo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ao=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xo(e){const t=e.config;$r(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Gr(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:fr},i=Ao.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Vt(r).slice(1)}`}async function Do(e){const t=await function(e){return Po=Po||Ro(e),Po}(e),n=Hs().gapi;return $r(n,e,"internal-error"),t.open({where:document.body,url:xo(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Oo,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Lr(e,"network-request-failed"),s=Hs().setTimeout((()=>{r(i)}),No.get());function o(){Hs().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}const Lo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Mo{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(tp){}}}function Fo(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},Lo),{width:r.toString(),height:i.toString(),top:s,left:o}),c=Rt().toLowerCase();n&&(a=Oi(c)?"_blank":n),Pi(c)&&(t=t||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce(((e,t)=>{let[n,r]=t;return`${e}${n}=${r},`}),"");if(function(){var e;return Mi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Mo(null);const u=window.open(t||"",a,h);$r(u,e,"popup-blocked");try{u.focus()}catch(tp){}return new Mo(u)}const Uo="__/auth/handler",jo="emulator/auth/handler",$o=encodeURIComponent("fac");async function Ho(e,t,n,r,i,s){$r(e.config.authDomain,e,"auth-domain-config-required"),$r(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:fr,eventId:i};if(t instanceof ms){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",$t(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof gs){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const h of Object.keys(a))void 0===a[h]&&delete a[h];const l=await e._getAppCheckToken(),c=l?`#${$o}=${encodeURIComponent(l)}`:"";return`${function(e){let{config:t}=e;if(!t.emulator)return`https://${t.authDomain}/${Uo}`;return Gr(t,jo)}(e)}?${Vt(a).slice(1)}${c}`}const Wo="webStorageSupport";const qo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Fs,this._completeRedirectFn=vo,this._overrideRedirectResult=mo}async _openPopup(e,t,n,r){var i;Wr(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Fo(e,await Ho(e,t,n,qr(),r),js())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Hs().location.href=e}(await Ho(e,t,n,qr(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Wr(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await Do(e),n=new yo(e);return t.register("authEvent",(t=>{$r(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Wo,{type:Wo},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[Wo];void 0!==i&&t(!!i),Dr(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Eo(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ui()||Ni()||Mi()}};var Vo="@firebase/auth",Bo="1.9.1";class zo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$r(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ko=Tt("authIdTokenMaxAge")||300;let Go=null;var Yo,Jo;Yo={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Lr("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Bi=Yo,Jo="Browser",cr(new Zt("auth",((e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;$r(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:Jo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ji(Jo)},c=new Wi(r,i,s,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ii);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),cr(new Zt("auth-internal",(e=>(e=>new zo(e))(qi(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),_r(Vo,Bo,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Jo)),_r(Vo,Bo,"esm2017");const Qo="@firebase/database",Xo="1.0.13";let Zo="";function ea(e){Zo=e}class ta{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Mt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Lt(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class na{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ut(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ra=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new ta(t)}}catch(tp){}return new na},ia=ra("localStorage"),sa=ra("sessionStorage"),oa=new hn("@firebase/database"),aa=function(){let e=1;return function(){return e++}}(),la=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,ht(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new Kt;n.update(t);const r=n.digest();return pt.encodeByteArray(r)},ca=function(){let e="";for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=ca.apply(null,n):e+="object"===typeof n?Mt(n):n,e+=" "}return e};let ha=null,ua=!0;const da=function(e,t){ht(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(oa.logLevel=sn.VERBOSE,ha=oa.log.bind(oa),t&&sa.set("logging_enabled",!0)):"function"===typeof e?ha=e:(ha=null,sa.remove("logging_enabled"))},pa=function(){if(!0===ua&&(ua=!1,null===ha&&!0===sa.get("logging_enabled")&&da(!0)),ha){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=ca.apply(null,t);ha(r)}},fa=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];pa(e,...n)}},ma=function(){const e="FIREBASE INTERNAL ERROR: "+ca(...arguments);oa.error(e)},ga=function(){const e=`FIREBASE FATAL ERROR: ${ca(...arguments)}`;throw oa.error(e),new Error(e)},_a=function(){const e="FIREBASE WARNING: "+ca(...arguments);oa.warn(e)},va=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},ya="[MIN_NAME]",wa="[MAX_NAME]",Ca=function(e,t){if(e===t)return 0;if(e===ya||t===wa)return-1;if(t===ya||e===wa)return 1;{const n=Pa(e),r=Pa(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},ba=function(e,t){return e===t?0:e<t?-1:1},Ia=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Mt(t))},Ea=function(e){if("object"!==typeof e||null===e)return Mt(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Mt(t[r]),n+=":",n+=Ea(e[t[r]]);return n+="}",n},Ta=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function Sa(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const ka=function(e){ht(!va(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Ra=new RegExp("^-?(0*)\\d{1,10}$"),Pa=function(e){if(Ra.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Na=function(e){try{e()}catch(tp){setTimeout((()=>{const t=tp.stack||"";throw _a("Exception was thrown by user callback.",t),tp}),Math.floor(0))}},Oa=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class Aa{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ur(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then((e=>this.appCheck=e))}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){_a(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class xa{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(pa("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',_a(e)}}class Da{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Da.OWNER="owner";const La="5",Ma=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Fa="ac",Ua="websocket",ja="long_polling";class $a{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ia.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ia.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Ha(e,t,n){let r;if(ht("string"===typeof t,"typeof type must == string"),ht("object"===typeof n,"typeof params must == object"),t===Ua)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ja)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return Sa(n,((e,t)=>{i.push(e+"="+t)})),r+i.join("&")}class Wa{constructor(){this.counters_={}}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Ut(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return vt(this.counters_)}}const qa={},Va={};function Ba(e){const t=e.toString();return qa[t]||(qa[t]=new Wa),qa[t]}class za{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Na((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Ka="start";class Ga{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=fa(e),this.stats_=Ba(t),this.urlFn=e=>(this.appCheckToken&&(e[Fa]=this.appCheckToken),Ha(t,ja,e))}open(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new za(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Ot()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ya((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,s,o,a,l]=t;if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===Ka)n.id=s,n.password=o;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,(()=>{n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,s]=t;n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,s)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Ka]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=La,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Fa]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&Ma.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ga.forceAllow_=!0}static forceDisallow(){Ga.forceDisallow_=!0}static isAvailable(){return!Ot()&&(!!Ga.forceAllow_||!Ga.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Mt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=mt(t),r=Ta(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ot())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Mt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ya{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Ot())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=aa(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ya.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(tp){pa("frame writing exception"),tp.stack&&pa(tp.stack),pa(tp)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||pa("No IE domain setting required")}catch(tp){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){Ot()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{pa("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(tp){}}),Math.floor(1))}}let Ja=null;"undefined"!==typeof MozWebSocket?Ja=MozWebSocket:"undefined"!==typeof WebSocket&&(Ja=WebSocket);class Qa{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=fa(this.connId),this.stats_=Ba(t),this.connURL=Qa.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={};return s.v=La,!Ot()&&"undefined"!==typeof location&&location.hostname&&Ma.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s[Fa]=r),i&&(s.p=i),Ha(e,Ua,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ia.set("previous_websocket_failure",!0);try{let e;if(Ot()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${La}/${Zo}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"/chatapp",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new Ja(this.connURL,[],e)}catch(tp){this.log_("Error instantiating WebSocket.");const t=tp.message||tp.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Qa.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Ja&&!Qa.forceDisallow_}static previouslyFailed(){return ia.isInMemoryStorage||!0===ia.get("previous_websocket_failure")}markConnectionHealthy(){ia.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Lt(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ht(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Mt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Ta(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(tp){this.log_("Exception thrown from WebSocket.send():",tp.message||tp.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Qa.responsesRequiredToBeHealthy=2,Qa.healthyTimeout=3e4;class Xa{static get ALL_TRANSPORTS(){return[Ga,Qa]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Qa&&Qa.isAvailable();let n=t&&!Qa.previouslyFailed();if(e.webSocketOnly&&(t||_a("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Qa];else{const e=this.transports_=[];for(const t of Xa.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Xa.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Xa.globalTransportInitialized_=!1;class Za{constructor(e,t,n,r,i,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=fa("c:"+this.id+":"),this.transportManager_=new Xa(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Oa((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ia("t",e),n=Ia("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ia("t",e),n=Ia("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ia("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?ma("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ma("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),La!==n&&_a("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Oa((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Oa((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ia.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class el{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class tl{constructor(e){this.allowedEvents_=e,this.listeners_={},ht(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(let e=0;e<i.length;e++)i[e].callback.apply(i[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){ht(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class nl extends tl{static getInstance(){return new nl}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Pt()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(e){return ht("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class rl{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function il(){return new rl("")}function sl(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ol(e){return e.pieces_.length-e.pieceNum_}function al(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new rl(e.pieces_,t)}function ll(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function cl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function hl(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new rl(t,0)}function ul(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof rl)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new rl(n,0)}function dl(e){return e.pieceNum_>=e.pieces_.length}function pl(e,t){const n=sl(e),r=sl(t);if(null===n)return t;if(n===r)return pl(al(e),al(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function fl(e,t){if(ol(e)!==ol(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function ml(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(ol(e)>ol(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class gl{constructor(e,t){this.errorPrefix_=t,this.parts_=cl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Qt(this.parts_[n]);_l(this)}}function _l(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+vl(e))}function vl(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class yl extends tl{static getInstance(){return new yl}constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}getInitialEvent(e){return ht("visible"===e,"Unknown event type: "+e),[this.visible_]}}const wl=1e3;class Cl extends el{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Cl.nextPersistentConnectionId_++,this.log_=fa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=wl,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!Ot())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");yl.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&nl.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Mt(i)),ht(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new St,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),ht(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ht(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,(i=>{const s=i.d,o=i.s;Cl.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&Ut(e,"w")){const n=jt(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();_a(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Ft(e).claims;return"object"===typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Ft(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),ht(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(e=>{r&&setTimeout((()=>{r(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Mt(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ma("Unrecognized action received from server: "+Mt(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ht(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=wl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=wl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=wl),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Cl.nextConnectionId_++,i=this.lastSessionId;let s=!1,o=null;const a=function(){o?o.close():(s=!0,n())},l=function(e){ht(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);s?pa("getToken() completed but was canceled"):(pa("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new Za(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{_a(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(ma){this.log_("Failed to get token: "+ma),s||(this.repoInfo_.nodeAdmin&&_a(ma),a())}}}interrupt(e){pa("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pa("Resuming connection for reason: "+e),delete this.interruptReasons_[e],$t(this.interruptReasons_)&&(this.reconnectDelay_=wl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Ea(e))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new rl(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){pa("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){pa("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";Ot()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Zo.replace(/\./g,"-")]=1,Pt()?e["framework.cordova"]=1:Nt()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=nl.getInstance().currentlyOnline();return $t(this.interruptReasons_)&&e}}Cl.nextPersistentConnectionId_=0,Cl.nextConnectionId_=0;class bl{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new bl(e,t)}}class Il{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new bl(ya,e),r=new bl(ya,t);return 0!==this.compare(n,r)}minPost(){return bl.MIN}}let El;class Tl extends Il{static get __EMPTY_NODE(){return El}static set __EMPTY_NODE(e){El=e}compare(e,t){return Ca(e.name,t.name)}isDefinedOn(e){throw ut("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return bl.MIN}maxPost(){return new bl(wa,El)}makePost(e,t){return ht("string"===typeof e,"KeyIndex indexValue must always be a string."),new bl(e,El)}toString(){return".key"}}const Sl=new Tl;class kl{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Rl{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Rl.RED,this.left=null!=r?r:Pl.EMPTY_NODE,this.right=null!=i?i:Pl.EMPTY_NODE}copy(e,t,n,r,i){return new Rl(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Pl.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Pl.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Rl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Rl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Rl.RED=!0,Rl.BLACK=!1;class Pl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pl.EMPTY_NODE;this.comparator_=e,this.root_=t}insert(e,t){return new Pl(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Rl.BLACK,null,null))}remove(e){return new Pl(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Rl.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new kl(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new kl(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new kl(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new kl(this.root_,null,this.comparator_,!0,e)}}function Nl(e,t){return Ca(e.name,t.name)}function Ol(e,t){return Ca(e,t)}let Al;Pl.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Rl(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const xl=function(e){return"number"===typeof e?"number:"+ka(e):"string:"+e},Dl=function(e){if(e.isLeafNode()){const t=e.val();ht("string"===typeof t||"number"===typeof t||"object"===typeof t&&Ut(t,".sv"),"Priority must be a string or number.")}else ht(e===Al||e.isEmpty(),"priority of unexpected type.");ht(e===Al||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Ll,Ml,Fl;class Ul{static set __childrenNodeConstructor(e){Ll=e}static get __childrenNodeConstructor(){return Ll}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ul.__childrenNodeConstructor.EMPTY_NODE;this.value_=e,this.priorityNode_=t,this.lazyHash_=null,ht(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Dl(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ul(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Ul.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return dl(e)?this:".priority"===sl(e)?this.priorityNode_:Ul.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Ul.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=sl(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(ht(".priority"!==n||1===ol(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Ul.__childrenNodeConstructor.EMPTY_NODE.updateChild(al(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+xl(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?ka(this.value_):this.value_,this.lazyHash_=la(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ul.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ul.__childrenNodeConstructor?-1:(ht(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=Ul.VALUE_TYPE_ORDER.indexOf(t),i=Ul.VALUE_TYPE_ORDER.indexOf(n);return ht(r>=0,"Unknown leaf type: "+t),ht(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Ul.VALUE_TYPE_ORDER=["object","boolean","number","string"];const jl=new class extends Il{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Ca(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return bl.MIN}maxPost(){return new bl(wa,new Ul("[PRIORITY-POST]",Fl))}makePost(e,t){const n=Ml(e);return new bl(t,new Ul("[PRIORITY-POST]",n))}toString(){return".priority"}},$l=Math.log(2);class Hl{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/$l,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Wl=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Rl(a,o.node,Rl.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),h=i(l+1,r);return o=e[l],a=n?n(o):o,new Rl(a,o.node,Rl.BLACK,c,h)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const c=i(s+1,a),h=e[s],u=n?n(h):h;l(new Rl(u,h.node,r,null,c))},l=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,Rl.BLACK):(a(r,Rl.BLACK),a(r,Rl.RED))}return s}(new Hl(e.length));return new Pl(r||t,s)};let ql;const Vl={};class Bl{static get Default(){return ht(Vl&&jl,"ChildrenNode.ts has not been loaded"),ql=ql||new Bl({".priority":Vl},{".priority":jl}),ql}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=jt(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Pl?t:null}hasIndex(e){return Ut(this.indexSet_,e.toString())}addIndex(e,t){ht(e!==Sl,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(bl.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?Wl(n,e.getCompare()):Vl;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=s,new Bl(c,l)}addToIndexes(e,t){const n=Ht(this.indexes_,((n,r)=>{const i=jt(this.indexSet_,r);if(ht(i,"Missing index implementation for "+r),n===Vl){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(bl.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),Wl(n,i.getCompare())}return Vl}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new bl(e.name,r))),i.insert(e,e.node)}}));return new Bl(n,this.indexSet_)}removeFromIndexes(e,t){const n=Ht(this.indexes_,(n=>{if(n===Vl)return n;{const r=t.get(e.name);return r?n.remove(new bl(e.name,r)):n}}));return new Bl(n,this.indexSet_)}}let zl;class Kl{static get EMPTY_NODE(){return zl||(zl=new Kl(new Pl(Ol),null,Bl.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Dl(this.priorityNode_),this.children_.isEmpty()&&ht(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||zl}updatePriority(e){return this.children_.isEmpty()?this:new Kl(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?zl:t}}getChild(e){const t=sl(e);return null===t?this:this.getImmediateChild(t).getChild(al(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(ht(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new bl(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const s=r.isEmpty()?zl:this.priorityNode_;return new Kl(r,s,i)}}updateChild(e,t){const n=sl(e);if(null===n)return t;{ht(".priority"!==sl(e)||1===ol(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(al(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(jl,((s,o)=>{t[s]=o.val(e),n++,i&&Kl.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1})),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+xl(this.getPriority().val())+":"),this.forEachChild(jl,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":la(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new bl(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new bl(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new bl(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,bl.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,bl.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Gl?-1:0}withIndex(e){if(e===Sl||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Kl(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Sl||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(jl),n=t.getIterator(jl);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===Sl?null:this.indexMap_.get(e.toString())}}Kl.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Gl=new class extends Kl{constructor(){super(new Pl(Ol),Kl.EMPTY_NODE,Bl.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Kl.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(bl,{MIN:{value:new bl(ya,Kl.EMPTY_NODE)},MAX:{value:new bl(wa,Gl)}}),Tl.__EMPTY_NODE=Kl.EMPTY_NODE,Ul.__childrenNodeConstructor=Kl,Al=Gl,function(e){Fl=e}(Gl);function Yl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return Kl.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),ht(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new Ul(e,Yl(t))}if(e instanceof Array){let n=Kl.EMPTY_NODE;return Sa(e,((t,r)=>{if(Ut(e,t)&&"."!==t.substring(0,1)){const e=Yl(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(Yl(t))}{const n=[];let r=!1;if(Sa(e,((e,t)=>{if("."!==e.substring(0,1)){const i=Yl(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new bl(e,i)))}})),0===n.length)return Kl.EMPTY_NODE;const i=Wl(n,Nl,(e=>e.name),Ol);if(r){const e=Wl(n,jl.getCompare());return new Kl(i,Yl(t),new Bl({".priority":e},{".priority":jl}))}return new Kl(i,Yl(t),Bl.Default)}}!function(e){Ml=e}(Yl);class Jl extends Il{constructor(e){super(),this.indexPath_=e,ht(!dl(e)&&".priority"!==sl(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Ca(e.name,t.name):i}makePost(e,t){const n=Yl(e),r=Kl.EMPTY_NODE.updateChild(this.indexPath_,n);return new bl(t,r)}maxPost(){const e=Kl.EMPTY_NODE.updateChild(this.indexPath_,Gl);return new bl(wa,e)}toString(){return cl(this.indexPath_,0).join("/")}}const Ql=new class extends Il{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Ca(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return bl.MIN}maxPost(){return bl.MAX}makePost(e,t){const n=Yl(e);return new bl(t,n)}toString(){return".value"}};function Xl(e){return{type:"value",snapshotNode:e}}function Zl(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ec(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function tc(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class nc{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){ht(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(ec(t,o)):ht(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Zl(t,n)):s.trackChildChange(tc(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(jl,((e,r)=>{t.hasChild(e)||n.trackChildChange(ec(e,r))})),t.isLeafNode()||t.forEachChild(jl,((t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(tc(t,r,i))}else n.trackChildChange(Zl(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Kl.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class rc{constructor(e){this.indexedFilter_=new nc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rc.getStartPost_(e),this.endPost_=rc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new bl(t,n))||(n=Kl.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Kl.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Kl.EMPTY_NODE);const i=this;return t.forEachChild(jl,((e,t)=>{i.matches(new bl(e,t))||(r=r.updateImmediateChild(e,Kl.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class ic{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new rc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new bl(t,n))||(n=Kl.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=Kl.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=Kl.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(Kl.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,Kl.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();const o=e;ht(o.numChildren()===this.limit_,"");const a=new bl(t,n),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let h=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=h&&(h.name===t||o.hasChild(h.name));)h=r.getChildAfterChild(this.index_,h,this.reverse_);const u=null==h?1:s(h,a);if(c&&!n.isEmpty()&&u>=0)return null!=i&&i.trackChildChange(tc(t,n,e)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(ec(t,e));const n=o.updateImmediateChild(t,Kl.EMPTY_NODE);return null!=h&&this.rangedFilter_.matches(h)?(null!=i&&i.trackChildChange(Zl(h.name,h.node)),n.updateImmediateChild(h.name,h.node)):n}}return n.isEmpty()?e:c&&s(l,a)>=0?(null!=i&&(i.trackChildChange(ec(l.name,l.node)),i.trackChildChange(Zl(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(l.name,Kl.EMPTY_NODE)):e}}class sc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=jl}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return ht(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ht(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ya}hasEnd(){return this.endSet_}getIndexEndValue(){return ht(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ht(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:wa}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return ht(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===jl}copy(){const e=new sc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function oc(e){const t={};if(e.isDefault())return t;let n;if(e.index_===jl?n="$priority":e.index_===Ql?n="$value":e.index_===Sl?n="$key":(ht(e.index_ instanceof Jl,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Mt(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Mt(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Mt(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Mt(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Mt(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function ac(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==jl&&(t.i=e.index_.toString()),t}class lc extends el{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(ht(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=fa("p:rest:"),this.listens_={}}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=lc.getListenId_(e,n),o={};this.listens_[s]=o;const a=oc(e._queryParams);this.restRequest_(i+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),jt(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=lc.getListenId_(e,t);delete this.listens_[n]}get(e){const t=oc(e._queryParams),n=e._path.toString(),r=new St;return this.restRequest_(n+".json",t,((e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(e){}restRequest_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((r=>{let[i,s]=r;i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Vt(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=Lt(a.responseText)}catch(tp){_a("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&_a("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()}))}}class cc{constructor(){this.rootNode_=Kl.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function hc(){return{value:null,children:new Map}}function uc(e,t,n){if(dl(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=sl(t);e.children.has(r)||e.children.set(r,hc());uc(e.children.get(r),t=al(t),n)}}function dc(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{dc(r,new rl(t.toString()+"/"+e),n)}))}class pc{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Sa(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class fc{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new pc(e);const n=1e4+2e4*Math.random();Oa(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Sa(e,((e,r)=>{r>0&&Ut(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),Oa(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var mc;function gc(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(mc||(mc={}));class _c{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=mc.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(dl(this.path)){if(null!=this.affectedTree.value)return ht(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new rl(e));return new _c(il(),t,this.revert)}}return ht(sl(this.path)===e,"operationForChild called for unrelated child."),new _c(al(this.path),this.affectedTree,this.revert)}}class vc{constructor(e,t){this.source=e,this.path=t,this.type=mc.LISTEN_COMPLETE}operationForChild(e){return dl(this.path)?new vc(this.source,il()):new vc(this.source,al(this.path))}}class yc{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=mc.OVERWRITE}operationForChild(e){return dl(this.path)?new yc(this.source,il(),this.snap.getImmediateChild(e)):new yc(this.source,al(this.path),this.snap)}}class wc{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=mc.MERGE}operationForChild(e){if(dl(this.path)){const t=this.children.subtree(new rl(e));return t.isEmpty()?null:t.value?new yc(this.source,il(),t.value):new wc(this.source,il(),t)}return ht(sl(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new wc(this.source,al(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Cc{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(dl(e))return this.isFullyInitialized()&&!this.filtered_;const t=sl(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class bc{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ic(e,t,n,r,i,s){const o=r.filter((e=>e.type===n));o.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw ut("Should only compare child_ events.");const r=new bl(t.childName,t.snapshotNode),i=new bl(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n))),o.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach((i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function Ec(e,t){return{eventCache:e,serverCache:t}}function Tc(e,t,n,r){return Ec(new Cc(t,n,r),e.serverCache)}function Sc(e,t,n,r){return Ec(e.eventCache,new Cc(t,n,r))}function kc(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Rc(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Pc;class Nc{static fromObject(e){let t=new Nc(null);return Sa(e,((e,n)=>{t=t.set(new rl(e),n)})),t}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(Pc||(Pc=new Pl(ba)),Pc);this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:il(),value:this.value};if(dl(e))return null;{const n=sl(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(al(e),t);if(null!=i){return{path:ul(new rl(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(dl(e))return this;{const t=sl(e),n=this.children.get(t);return null!==n?n.subtree(al(e)):new Nc(null)}}set(e,t){if(dl(e))return new Nc(t,this.children);{const n=sl(e),r=(this.children.get(n)||new Nc(null)).set(al(e),t),i=this.children.insert(n,r);return new Nc(this.value,i)}}remove(e){if(dl(e))return this.children.isEmpty()?new Nc(null):new Nc(null,this.children);{const t=sl(e),n=this.children.get(t);if(n){const r=n.remove(al(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Nc(null):new Nc(this.value,i)}return this}}get(e){if(dl(e))return this.value;{const t=sl(e),n=this.children.get(t);return n?n.get(al(e)):null}}setTree(e,t){if(dl(e))return t;{const n=sl(e),r=(this.children.get(n)||new Nc(null)).setTree(al(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Nc(this.value,i)}}fold(e){return this.fold_(il(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(ul(e,r),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,il(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(dl(e))return null;{const r=sl(e),i=this.children.get(r);return i?i.findOnPath_(al(e),ul(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,il(),t)}foreachOnPath_(e,t,n){if(dl(e))return this;{this.value&&n(t,this.value);const r=sl(e),i=this.children.get(r);return i?i.foreachOnPath_(al(e),ul(t,r),n):new Nc(null)}}foreach(e){this.foreach_(il(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(ul(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Oc{constructor(e){this.writeTree_=e}static empty(){return new Oc(new Nc(null))}}function Ac(e,t,n){if(dl(t))return new Oc(new Nc(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=pl(i,t);return s=s.updateChild(o,n),new Oc(e.writeTree_.set(i,s))}{const r=new Nc(n),i=e.writeTree_.setTree(t,r);return new Oc(i)}}}function xc(e,t,n){let r=e;return Sa(n,((e,n)=>{r=Ac(r,ul(t,e),n)})),r}function Dc(e,t){if(dl(t))return Oc.empty();{const n=e.writeTree_.setTree(t,new Nc(null));return new Oc(n)}}function Lc(e,t){return null!=Mc(e,t)}function Mc(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(pl(n.path,t)):null}function Fc(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(jl,((e,n)=>{t.push(new bl(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new bl(e,n.value))})),t}function Uc(e,t){if(dl(t))return e;{const n=Mc(e,t);return new Oc(null!=n?new Nc(n):e.writeTree_.subtree(t))}}function jc(e){return e.writeTree_.isEmpty()}function $c(e,t){return Hc(il(),e.writeTree_,t)}function Hc(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,i)=>{".priority"===t?(ht(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Hc(ul(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(ul(e,".priority"),r)),n}}function Wc(e,t){return th(t,e)}function qc(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));ht(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&Vc(t,r.path)?i=!1:ml(r.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=zc(e.allWrites,Bc,il()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=Dc(e.visibleWrites,r.path);else{Sa(r.children,(t=>{e.visibleWrites=Dc(e.visibleWrites,ul(r.path,t))}))}return!0}return!1}function Vc(e,t){if(e.snap)return ml(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&ml(ul(e.path,n),t))return!0;return!1}function Bc(e){return e.visible}function zc(e,t,n){let r=Oc.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)ml(n,e)?(t=pl(n,e),r=Ac(r,t,s.snap)):ml(e,n)&&(t=pl(e,n),r=Ac(r,il(),s.snap.getChild(t)));else{if(!s.children)throw ut("WriteRecord should have .snap or .children");if(ml(n,e))t=pl(n,e),r=xc(r,t,s.children);else if(ml(e,n))if(t=pl(e,n),dl(t))r=xc(r,il(),s.children);else{const e=jt(s.children,sl(t));if(e){const n=e.getChild(al(t));r=Ac(r,il(),n)}}}}}return r}function Kc(e,t,n,r,i){if(r||i){const s=Uc(e.visibleWrites,t);if(!i&&jc(s))return n;if(i||null!=n||Lc(s,il())){const s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ml(e.path,t)||ml(t,e.path))};return $c(zc(e.allWrites,s,t),n||Kl.EMPTY_NODE)}return null}{const r=Mc(e.visibleWrites,t);if(null!=r)return r;{const r=Uc(e.visibleWrites,t);if(jc(r))return n;if(null!=n||Lc(r,il())){return $c(r,n||Kl.EMPTY_NODE)}return null}}}function Gc(e,t,n,r){return Kc(e.writeTree,e.treePath,t,n,r)}function Yc(e,t){return function(e,t,n){let r=Kl.EMPTY_NODE;const i=Mc(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(jl,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const i=Uc(e.visibleWrites,t);return n.forEachChild(jl,((e,t)=>{const n=$c(Uc(i,new rl(e)),t);r=r.updateImmediateChild(e,n)})),Fc(i).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return Fc(Uc(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Jc(e,t,n,r){return function(e,t,n,r,i){ht(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=ul(t,n);if(Lc(e.visibleWrites,s))return null;{const t=Uc(e.visibleWrites,s);return jc(t)?i.getChild(n):$c(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Qc(e,t){return function(e,t){return Mc(e.visibleWrites,t)}(e.writeTree,ul(e.treePath,t))}function Xc(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const l=Uc(e.visibleWrites,t),c=Mc(l,il());if(null!=c)a=c;else{if(null==n)return[];a=$c(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}function Zc(e,t,n){return function(e,t,n,r){const i=ul(t,n),s=Mc(e.visibleWrites,i);if(null!=s)return s;if(r.isCompleteForChild(n))return $c(Uc(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function eh(e,t){return th(ul(e.treePath,t),e.writeTree)}function th(e,t){return{treePath:e,writeTree:t}}class nh{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;ht("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),ht(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,tc(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,ec(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Zl(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ut("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,tc(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const rh=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class ih{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Cc(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Zc(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Rc(this.viewCache_),i=Xc(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function sh(e,t,n,r,i){const s=new nh;let o,a;if(n.type===mc.OVERWRITE){const l=n;l.source.fromUser?o=lh(e,t,l.path,l.snap,r,i,s):(ht(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!dl(l.path),o=ah(e,t,l.path,l.snap,r,i,a,s))}else if(n.type===mc.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach(((r,l)=>{const c=ul(n,r);ch(t,sl(c))&&(a=lh(e,a,c,l,i,s,o))})),r.foreach(((r,l)=>{const c=ul(n,r);ch(t,sl(c))||(a=lh(e,a,c,l,i,s,o))})),a}(e,t,l.path,l.children,r,i,s):(ht(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=uh(e,t,l.path,l.children,r,i,a,s))}else if(n.type===mc.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=Qc(r,n))return t;{const a=new ih(r,t,i),l=t.eventCache.getNode();let c;if(dl(n)||".priority"===sl(n)){let n;if(t.serverCache.isFullyInitialized())n=Gc(r,Rc(t));else{const e=t.serverCache.getNode();ht(e instanceof Kl,"serverChildren would be complete if leaf node"),n=Yc(r,e)}c=e.filter.updateFullNode(l,n,s)}else{const i=sl(n);let h=Zc(r,i,t.serverCache);null==h&&t.serverCache.isCompleteForChild(i)&&(h=l.getImmediateChild(i)),c=null!=h?e.filter.updateChild(l,i,h,al(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,Kl.EMPTY_NODE,al(n),a,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Gc(r,Rc(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=Qc(r,il()),Tc(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=Qc(i,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(dl(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return ah(e,t,n,l.getNode().getChild(n),i,s,a,o);if(dl(n)){let r=new Nc(null);return l.getNode().forEachChild(Sl,((e,t)=>{r=r.set(new rl(e),t)})),uh(e,t,n,r,i,s,a,o)}return t}{let c=new Nc(null);return r.foreach(((e,t)=>{const r=ul(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))})),uh(e,t,n,c,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==mc.LISTEN_COMPLETE)throw ut("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=Sc(t,s.getNode(),s.isFullyInitialized()||dl(n),s.isFiltered());return oh(e,o,n,r,rh,i)}(e,t,n.path,r,s)}const l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=kc(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Xl(kc(t)))}}(t,o,l),{viewCache:o,changes:l}}function oh(e,t,n,r,i,s){const o=t.eventCache;if(null!=Qc(r,n))return t;{let a,l;if(dl(n))if(ht(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Rc(t),i=Yc(r,n instanceof Kl?n:Kl.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Gc(r,Rc(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const c=sl(n);if(".priority"===c){ht(1===ol(n),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=Jc(r,n,i,l);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const h=al(n);let u;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=Jc(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(h,e):o.getNode().getImmediateChild(c)}else u=Zc(r,c,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),c,u,h,i,s):o.getNode()}}return Tc(t,a,o.isFullyInitialized()||dl(n),e.filter.filtersNodes())}}function ah(e,t,n,r,i,s,o,a){const l=t.serverCache;let c;const h=o?e.filter:e.filter.getIndexedFilter();if(dl(n))c=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,r);c=h.updateFullNode(l.getNode(),e,null)}else{const e=sl(n);if(!l.isCompleteForPath(n)&&ol(n)>1)return t;const i=al(n),s=l.getNode().getImmediateChild(e).updateChild(i,r);c=".priority"===e?h.updatePriority(l.getNode(),s):h.updateChild(l.getNode(),e,s,i,rh,null)}const u=Sc(t,c,l.isFullyInitialized()||dl(n),h.filtersNodes());return oh(e,u,n,i,new ih(i,u,s),a)}function lh(e,t,n,r,i,s,o){const a=t.eventCache;let l,c;const h=new ih(i,t,s);if(dl(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,o),l=Tc(t,c,!0,e.filter.filtersNodes());else{const i=sl(n);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),r),l=Tc(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=al(n),c=a.getNode().getImmediateChild(i);let u;if(dl(s))u=r;else{const e=h.getCompleteChild(i);u=null!=e?".priority"===ll(s)&&e.getChild(hl(s)).isEmpty()?e:e.updateChild(s,r):Kl.EMPTY_NODE}if(c.equals(u))l=t;else{l=Tc(t,e.filter.updateChild(a.getNode(),i,u,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function ch(e,t){return e.eventCache.isCompleteForChild(t)}function hh(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function uh(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=dl(n)?r:new Nc(null).setTree(n,r);const h=t.serverCache.getNode();return l.children.inorderTraversal(((n,r)=>{if(h.hasChild(n)){const l=hh(0,t.serverCache.getNode().getImmediateChild(n),r);c=ah(e,c,new rl(n),l,i,s,o,a)}})),l.children.inorderTraversal(((n,r)=>{const l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!h.hasChild(n)&&!l){const l=hh(0,t.serverCache.getNode().getImmediateChild(n),r);c=ah(e,c,new rl(n),l,i,s,o,a)}})),c}class dh{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new nc(n.getIndex()),i=(s=n).loadsAllData()?new nc(s.getIndex()):s.hasLimit()?new ic(s):new rc(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(Kl.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(Kl.EMPTY_NODE,a.getNode(),null),h=new Cc(l,o.isFullyInitialized(),r.filtersNodes()),u=new Cc(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ec(u,h),this.eventGenerator_=new bc(this.query_)}get query(){return this.query_}}function ph(e,t){const n=Rc(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!dl(t)&&!n.getImmediateChild(sl(t)).isEmpty())?n.getChild(t):null}function fh(e){return 0===e.eventRegistrations_.length}function mh(e,t,n){const r=[];if(n){ht(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){const i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function gh(e,t,n,r){t.type===mc.MERGE&&null!==t.source.queryId&&(ht(Rc(e.viewCache_),"We should always have a full cache before handling merges"),ht(kc(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=sh(e.processor_,i,t,n,r);var o,a;return o=e.processor_,a=s.viewCache,ht(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),ht(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),ht(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,_h(e,s.changes,s.viewCache.eventCache.getNode(),null)}function _h(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Ic(e,i,"child_removed",t,r,n),Ic(e,i,"child_added",t,r,n),Ic(e,i,"child_moved",s,r,n),Ic(e,i,"child_changed",t,r,n),Ic(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let vh,yh;class wh{constructor(){this.views=new Map}}function Ch(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return ht(null!=s,"SyncTree gave us an op for an invalid query."),gh(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(gh(s,t,n,r));return i}}function bh(e,t,n,r,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Gc(n,i?r:null),s=!1;e?s=!0:r instanceof Kl?(e=Yc(n,r),s=!1):(e=Kl.EMPTY_NODE,s=!1);const o=Ec(new Cc(e,s,!1),new Cc(r,i,!1));return new dh(t,o)}return o}function Ih(e,t,n,r,i,s){const o=bh(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,r=[];n.getNode().isLeafNode()||n.getNode().forEachChild(jl,((e,t)=>{r.push(Zl(e,t))}));return n.isFullyInitialized()&&r.push(Xl(n.getNode())),_h(e,r,n.getNode(),t)}(o,n)}function Eh(e,t,n,r){const i=t._queryIdentifier,s=[];let o=[];const a=Ph(e);if("default"===i)for(const[l,c]of e.views.entries())o=o.concat(mh(c,n,r)),fh(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(i);t&&(o=o.concat(mh(t,n,r)),fh(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!Ph(e)&&s.push(new(ht(vh,"Reference.ts has not been loaded"),vh)(t._repo,t._path)),{removed:s,events:o}}function Th(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Sh(e,t){let n=null;for(const r of e.views.values())n=n||ph(r,t);return n}function kh(e,t){if(t._queryParams.loadsAllData())return Nh(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Rh(e,t){return null!=kh(e,t)}function Ph(e){return null!=Nh(e)}function Nh(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Oh=1;class Ah{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Nc(null),this.pendingWriteTree_={visibleWrites:Oc.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function xh(e,t,n,r,i){return function(e,t,n,r,i){ht(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Ac(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?$h(e,new yc({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Dh(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(qc(e.pendingWriteTree_,t)){let t=new Nc(null);return null!=r.snap?t=t.set(il(),!0):Sa(r.children,(e=>{t=t.set(new rl(e),!0)})),$h(e,new _c(r.path,t,n))}return[]}function Lh(e,t,n){return $h(e,new yc({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Mh(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||Rh(o,t))){const l=Eh(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!i){const n=-1!==c.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(s,((e,t)=>Ph(t)));if(n&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&Ph(t)){return[Nh(t)]}{let e=[];return t&&(e=Th(t)),Sa(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const r=n[t],i=r.query,s=qh(e,r);e.listenProvider_.startListening(Yh(i),Vh(e,i),s.hashFn,s.onComplete)}}}if(!i&&c.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(Yh(t),n)}else c.forEach((t=>{const n=e.queryToTagMap.get(Bh(t));e.listenProvider_.stopListening(Yh(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Bh(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return a}function Fh(e,t,n,r){const i=zh(e,r);if(null!=i){const r=Kh(i),s=r.path,o=r.queryId,a=pl(s,t);return Gh(e,s,new yc(gc(o),a,n))}return[]}function Uh(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,((e,t)=>{const n=pl(e,i);s=s||Sh(t,n),o=o||Ph(t)}));let a,l=e.syncPointTree_.get(i);if(l?(o=o||Ph(l),s=s||Sh(l,il())):(l=new wh,e.syncPointTree_=e.syncPointTree_.set(i,l)),null!=s)a=!0;else{a=!1,s=Kl.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild(((e,t)=>{const n=Sh(t,il());n&&(s=s.updateImmediateChild(e,n))}))}const c=Rh(l,t);if(!c&&!t._queryParams.loadsAllData()){const n=Bh(t);ht(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=Oh++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let h=Ih(l,t,n,Wc(e.pendingWriteTree_,i),s,a);if(!c&&!o&&!r){const n=kh(l,t);h=h.concat(function(e,t,n){const r=t._path,i=Vh(e,t),s=qh(e,n),o=e.listenProvider_.startListening(Yh(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)ht(!Ph(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold(((e,t,n)=>{if(!dl(e)&&t&&Ph(t))return[Nh(t).query];{let e=[];return t&&(e=e.concat(Th(t).map((e=>e.query)))),Sa(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const r=t[n];e.listenProvider_.stopListening(Yh(r),Vh(e,r))}}return o}(e,t,n))}return h}function jh(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,((e,n)=>{const r=Sh(n,pl(e,t));if(r)return r}));return Kc(r,t,i,n,!0)}function $h(e,t){return Hh(t,e.syncPointTree_,null,Wc(e.pendingWriteTree_,il()))}function Hh(e,t,n,r){if(dl(e.path))return Wh(e,t,n,r);{const i=t.get(il());null==n&&null!=i&&(n=Sh(i,il()));let s=[];const o=sl(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=eh(r,o);s=s.concat(Hh(a,l,e,t))}return i&&(s=s.concat(Ch(i,e,r,n))),s}}function Wh(e,t,n,r){const i=t.get(il());null==n&&null!=i&&(n=Sh(i,il()));let s=[];return t.children.inorderTraversal(((t,i)=>{const o=n?n.getImmediateChild(t):null,a=eh(r,t),l=e.operationForChild(t);l&&(s=s.concat(Wh(l,i,o,a)))})),i&&(s=s.concat(Ch(i,e,r,n))),s}function qh(e,t){const n=t.query,r=Vh(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Kl.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?function(e,t,n){const r=zh(e,n);if(r){const n=Kh(r),i=n.path,s=n.queryId,o=pl(i,t);return Gh(e,i,new vc(gc(s),o))}return[]}(e,n._path,r):function(e,t){return $h(e,new vc({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return Mh(e,n,null,r)}}}}function Vh(e,t){const n=Bh(t);return e.queryToTagMap.get(n)}function Bh(e){return e._path.toString()+"$"+e._queryIdentifier}function zh(e,t){return e.tagToQueryMap.get(t)}function Kh(e){const t=e.indexOf("$");return ht(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new rl(e.substr(0,t))}}function Gh(e,t,n){const r=e.syncPointTree_.get(t);ht(r,"Missing sync point for query tag that we're tracking");return Ch(r,n,Wc(e.pendingWriteTree_,t),null)}function Yh(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(ht(yh,"Reference.ts has not been loaded"),yh)(e._repo,e._path):e}class Jh{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Jh(t)}node(){return this.node_}}class Qh{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ul(this.path_,e);return new Qh(this.syncTree_,t)}node(){return jh(this.syncTree_,this.path_)}}const Xh=function(e,t,n){return e&&"object"===typeof e?(ht(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?Zh(e[".sv"],t,n):"object"===typeof e[".sv"]?eu(e[".sv"],t):void ht(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Zh=function(e,t,n){if("timestamp"===e)return n.timestamp;ht(!1,"Unexpected server value: "+e)},eu=function(e,t,n){e.hasOwnProperty("increment")||ht(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!==typeof r&&ht(!1,"Unexpected increment value: "+r);const i=t.node();if(ht(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!==typeof s?r:s+r},tu=function(e,t,n,r){return ru(t,new Qh(n,e),r)},nu=function(e,t,n){return ru(e,new Jh(t),n)};function ru(e,t,n){const r=e.getPriority().val(),i=Xh(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=Xh(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new Ul(s,Yl(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new Ul(i))),r.forEachChild(jl,((e,r)=>{const i=ru(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))})),s}}class iu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=e,this.parent=t,this.node=n}}function su(e,t){let n=t instanceof rl?t:new rl(t),r=e,i=sl(n);for(;null!==i;){const e=jt(r.node.children,i)||{children:{},childCount:0};r=new iu(i,r,e),n=al(n),i=sl(n)}return r}function ou(e){return e.node.value}function au(e,t){e.node.value=t,du(e)}function lu(e){return e.node.childCount>0}function cu(e,t){Sa(e.node.children,((n,r)=>{t(new iu(n,e,r))}))}function hu(e,t,n,r){n&&!r&&t(e),cu(e,(e=>{hu(e,t,!0,r)})),n&&r&&t(e)}function uu(e){return new rl(null===e.parent?e.name:uu(e.parent)+"/"+e.name)}function du(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===ou(e)&&!lu(e)}(n),i=Ut(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,du(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,du(e))}(e.parent,e.name,e)}const pu=/[\[\].#$\/\u0000-\u001F\u007F]/,fu=/[\[\].#$\u0000-\u001F\u007F]/,mu=10485760,gu=function(e){return"string"===typeof e&&0!==e.length&&!pu.test(e)},_u=function(e){return"string"===typeof e&&0!==e.length&&!fu.test(e)},vu=function(e,t,n,r){r&&void 0===t||yu(Jt(e,"value"),t,n)},yu=function(e,t,n){const r=n instanceof rl?new gl(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+vl(r));if("function"===typeof t)throw new Error(e+"contains a function "+vl(r)+" with contents = "+t.toString());if(va(t))throw new Error(e+"contains "+t.toString()+" "+vl(r));if("string"===typeof t&&t.length>mu/3&&Qt(t)>mu)throw new Error(e+"contains a string greater than "+mu+" utf8 bytes "+vl(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,i=!1;if(Sa(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!gu(t)))throw new Error(e+" contains an invalid key ("+t+") "+vl(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Qt(t),_l(e)}(r,t),yu(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=Qt(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),n&&i)throw new Error(e+' contains ".value" child '+vl(r)+" in addition to actual children.")}},wu=function(e,t,n,r){if((!r||void 0!==n)&&!_u(n))throw new Error(Jt(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Cu=function(e,t){if(".info"===sl(t))throw new Error(e+" failed = Can't modify data under /.info/")},bu=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!gu(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),_u(e)}(n))throw new Error(Jt(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Iu{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Eu(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null===n||fl(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function Tu(e,t,n){Eu(e,n),ku(e,(e=>fl(e,t)))}function Su(e,t,n){Eu(e,n),ku(e,(e=>ml(e,t)||ml(t,e)))}function ku(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(Ru(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function Ru(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();ha&&pa("event: "+n.toString()),Na(r)}}}const Pu="repo_interrupt";class Nu{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Iu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hc(),this.transactionQueueTree_=new iu,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ou(e,t,n){if(e.stats_=Ba(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new lc(e.repoInfo_,((t,n,r,i)=>{Du(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Lu(e,!0)),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Mt(n)}catch(tp){throw new Error("Invalid authOverride provided: "+tp)}}e.persistentConnection_=new Cl(e.repoInfo_,t,((t,n,r,i)=>{Du(e,t,n,r,i)}),(t=>{Lu(e,t)}),(t=>{!function(e,t){Sa(t,((t,n)=>{Mu(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return Va[n]||(Va[n]=t()),Va[n]}(e.repoInfo_,(()=>new fc(e.stats_,e.server_))),e.infoData_=new cc,e.infoSyncTree_=new Ah({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Lh(e.infoSyncTree_,t._path,o),setTimeout((()=>{i("ok")}),0)),s},stopListening:()=>{}}),Mu(e,"connected",!1),e.serverSyncTree_=new Ah({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,((n,r)=>{const s=i(n,r);Su(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Au(e){const t=e.infoData_.getNode(new rl(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function xu(e){return(t=(t={timestamp:Au(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Du(e,t,n,r,i){e.dataUpdateCount++;const s=new rl(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=Ht(n,(e=>Yl(e)));o=function(e,t,n,r){const i=zh(e,r);if(i){const r=Kh(i),s=r.path,o=r.queryId,a=pl(s,t),l=Nc.fromObject(n);return Gh(e,s,new wc(gc(o),a,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=Yl(n);o=Fh(e.serverSyncTree_,s,t,i)}else if(r){const t=Ht(n,(e=>Yl(e)));o=function(e,t,n){const r=Nc.fromObject(n);return $h(e,new wc({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=Yl(n);o=Lh(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=Bu(e,s)),Su(e.eventQueue_,a,o)}function Lu(e,t){Mu(e,"connected",t),!1===t&&function(e){Hu(e,"onDisconnectEvents");const t=xu(e),n=hc();dc(e.onDisconnect_,il(),((r,i)=>{const s=tu(r,i,e.serverSyncTree_,t);uc(n,r,s)}));let r=[];dc(n,il(),((t,n)=>{r=r.concat(Lh(e.serverSyncTree_,t,n));const i=Ju(e,t);Bu(e,i)})),e.onDisconnect_=hc(),Su(e.eventQueue_,il(),r)}(e)}function Mu(e,t,n){const r=new rl("/.info/"+t),i=Yl(n);e.infoData_.updateSnapshot(r,i);const s=Lh(e.infoSyncTree_,r,i);Su(e.eventQueue_,r,s)}function Fu(e){return e.nextWriteId_++}function Uu(e,t,n,r,i){Hu(e,"set",{path:t.toString(),value:n,priority:r});const s=xu(e),o=Yl(n,r),a=jh(e.serverSyncTree_,t),l=nu(o,a,s),c=Fu(e),h=xh(e.serverSyncTree_,t,l,c,!0);Eu(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,r)=>{const s="ok"===n;s||_a("set at "+t+" failed: "+n);const o=Dh(e.serverSyncTree_,c,!s);Su(e.eventQueue_,t,o),Wu(e,i,n,r)}));const u=Ju(e,t);Bu(e,u),Su(e.eventQueue_,u,[])}function ju(e,t,n){let r;r=".info"===sl(t._path)?Mh(e.infoSyncTree_,t,n):Mh(e.serverSyncTree_,t,n),Tu(e.eventQueue_,t._path,r)}function $u(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Pu)}function Hu(e){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];pa(t,...r)}function Wu(e,t,n,r){t&&Na((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}}))}function qu(e,t,n){return jh(e.serverSyncTree_,t,n)||Kl.EMPTY_NODE}function Vu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||Yu(e,t),ou(t)){const n=Ku(e,t);ht(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),i=qu(e,t,r);let s=i;const o=i.hash();for(let c=0;c<n.length;c++){const e=n[c];ht(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=pl(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),l=t;e.server_.put(l.toString(),a,(r=>{Hu(e,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(Dh(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();Yu(e,su(e.transactionQueueTree_,t)),Vu(e,e.transactionQueueTree_),Su(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Na(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{_a("transaction at "+l.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}Bu(e,t)}}),o)}(e,uu(t),n)}else lu(t)&&cu(t,(t=>{Vu(e,t)}))}function Bu(e,t){const n=zu(e,t),r=uu(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter((e=>0===e.status)),o=s.map((e=>e.currentWriteId));for(let l=0;l<t.length;l++){const s=t[l],c=pl(n,s.path);let h,u=!1;if(ht(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)u=!0,h=s.abortReason,i=i.concat(Dh(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)u=!0,h="maxretry",i=i.concat(Dh(e.serverSyncTree_,s.currentWriteId,!0));else{const n=qu(e,s.path,o);s.currentInputSnapshot=n;const r=t[l].update(n.val());if(void 0!==r){yu("transaction failed: Data returned ",r,s.path);let t=Yl(r);"object"===typeof r&&null!=r&&Ut(r,".priority")||(t=t.updatePriority(n.getPriority()));const a=s.currentWriteId,l=xu(e),c=nu(t,n,l);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=c,s.currentWriteId=Fu(e),o.splice(o.indexOf(a),1),i=i.concat(xh(e.serverSyncTree_,s.path,c,s.currentWriteId,s.applyLocally)),i=i.concat(Dh(e.serverSyncTree_,a,!0))}else u=!0,h="nodata",i=i.concat(Dh(e.serverSyncTree_,s.currentWriteId,!0))}Su(e.eventQueue_,n,i),i=[],u&&(t[l].status=2,a=t[l].unwatcher,setTimeout(a,Math.floor(0)),t[l].onComplete&&("nodata"===h?r.push((()=>t[l].onComplete(null,!1,t[l].currentInputSnapshot))):r.push((()=>t[l].onComplete(new Error(h),!1,null)))))}var a;Yu(e,e.transactionQueueTree_);for(let l=0;l<r.length;l++)Na(r[l]);Vu(e,e.transactionQueueTree_)}(e,Ku(e,n),r),r}function zu(e,t){let n,r=e.transactionQueueTree_;for(n=sl(t);null!==n&&void 0===ou(r);)r=su(r,n),n=sl(t=al(t));return r}function Ku(e,t){const n=[];return Gu(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function Gu(e,t,n){const r=ou(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);cu(t,(t=>{Gu(e,t,n)}))}function Yu(e,t){const n=ou(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,au(t,n.length>0?n:void 0)}cu(t,(t=>{Yu(e,t)}))}function Ju(e,t){const n=uu(zu(e,t)),r=su(e.transactionQueueTree_,t);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,(t=>{Qu(e,t)})),Qu(e,r),hu(r,(t=>{Qu(e,t)})),n}function Qu(e,t){const n=ou(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(ht(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(ht(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(Dh(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?au(t,void 0):n.length=s+1,Su(e.eventQueue_,uu(t),i);for(let e=0;e<r.length;e++)Na(r[e])}}const Xu=function(e,t){const n=Zu(e),r=n.namespace;"firebase.com"===n.domain&&ga(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||ga("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&_a("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new $a(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new rl(n.pathString)}},Zu=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"===typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(tp){}t+="/"+e}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):_a(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},ed="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",td=function(){let e=0;const t=[];return function(n){const r=n===e;let i;e=n;const s=new Array(8);for(i=7;i>=0;i--)s[i]=ed.charAt(n%64),n=Math.floor(n/64);ht(0===n,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)o+=ed.charAt(t[i]);return ht(20===o.length,"nextPushId: Length should be 20."),o}}();class nd{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Mt(this.snapshot.exportVal())}}class rd{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class id{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return ht(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class sd{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return dl(this._path)?null:ll(this._path)}get ref(){return new od(this._repo,this._path)}get _queryIdentifier(){const e=ac(this._queryParams),t=Ea(e);return"{}"===t?"default":t}get _queryObject(){return ac(this._queryParams)}isEqual(e){if(!((e=Xt(e))instanceof sd))return!1;const t=this._repo===e._repo,n=fl(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class od extends sd{constructor(e,t){super(e,t,new sc,!1)}get parent(){const e=hl(this._path);return null===e?null:new od(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ad{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new rl(e),n=cd(this.ref,e);return new ad(this._node.getChild(t),n,jl)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new ad(n,cd(this.ref,t),jl))))}hasChild(e){const t=new rl(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ld(e,t){return(e=Xt(e))._checkNotDeleted("ref"),void 0!==t?cd(e._root,t):e._root}function cd(e,t){var n,r,i,s;return null===sl((e=Xt(e))._path)?(n="child",r="path",s=!1,(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),wu(n,r,i,s)):wu("child","path",t,!1),new od(e._repo,ul(e._path,t))}function hd(e,t){e=Xt(e),Cu("push",e._path),vu("push",t,e._path,!0);const n=Au(e._repo),r=td(n),i=cd(e,r),s=cd(e,r);let o;return o=null!=t?ud(s,t).then((()=>s)):Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function ud(e,t){e=Xt(e),Cu("set",e._path),vu("set",t,e._path,!1);const n=new St;return Uu(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class dd{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new nd("value",this,new ad(e.snapshotNode,new od(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rd(this,e,t):null}matches(e){return e instanceof dd&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class pd{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rd(this,e,t):null}createEvent(e,t){ht(null!=e.childName,"Child events should have a childName.");const n=cd(new od(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new nd(e.type,this,new ad(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof pd&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function fd(e,t,n,r,i){let s;if("object"===typeof r&&(s=void 0,i=r),"function"===typeof r&&(s=r),i&&i.onlyOnce){const t=n,r=(n,r)=>{ju(e._repo,e,a),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const o=new id(n,s||void 0),a="value"===t?new dd(o):new pd(t,o);return function(e,t,n){let r;r=".info"===sl(t._path)?Uh(e.infoSyncTree_,t,n):Uh(e.serverSyncTree_,t,n),Tu(e.eventQueue_,t._path,r)}(e._repo,e,a),()=>ju(e._repo,e,a)}function md(e,t,n,r){return fd(e,"value",t,n,r)}!function(e){ht(!vh,"__referenceConstructor has already been defined"),vh=e}(od),function(e){ht(!yh,"__referenceConstructor has already been defined"),yh=e}(od);const gd={};let _d=!1;function vd(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||ga("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pa("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=Xu(s,i),c=l.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"/chatapp",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${c.namespace}`,l=Xu(s,i),c=l.repoInfo):o=!l.repoInfo.secure;const h=i&&o?new Da(Da.OWNER):new xa(e.name,e.options,t);bu("Invalid Firebase Database URL",l),dl(l.path)||ga("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,r){let i=gd[t.name];i||(i={},gd[t.name]=i);let s=i[e.toURLString()];s&&ga("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Nu(e,_d,n,r),i[e.toURLString()]=s,s}(c,e,h,new Aa(e,n));return new yd(u,e)}class yd{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ou(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new od(this._repo,il())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=gd[t];n&&n[e.key]===e||ga(`Database ${t}(${e.repoInfo_}) has already been deleted.`),$u(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&ga("Cannot call "+e+" on a deleted database.")}}Cl.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Cl.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){ea(fr),cr(new Zt("database",((e,t)=>{let{instanceIdentifier:n}=t;return vd(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)}),"PUBLIC").setMultipleInstances(!0)),_r(Qo,Xo,e),_r(Qo,Xo,"esm2017")}();const wd="firebasestorage.googleapis.com",Cd="storageBucket";class bd extends At{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(Td(e),`Firebase Storage: ${t} (${Td(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,bd.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Td(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Id,Ed;function Td(e){return"storage/"+e}function Sd(){return new bd(Id.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function kd(){return new bd(Id.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Rd(){return new bd(Id.CANCELED,"User canceled the upload/download.")}function Pd(e){return new bd(Id.INVALID_ARGUMENT,e)}function Nd(){return new bd(Id.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Id||(Id={}));class Od{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Od.makeFromUrl(e,t)}catch(tp){return new Od(e,"")}if(""===n.path)return n;throw r=e,new bd(Id.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===wd?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let l=0;l<a.length;l++){const t=a[l],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new Od(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new bd(Id.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Ad{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function xd(e,t,n,r){if(r<t)throw Pd(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Pd(`Invalid value for '${e}'. Expected ${n} or less.`)}function Dd(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function Ld(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Ed||(Ed={}));class Md{constructor(e,t,n,r,i,s,o,a,l,c,h){let u=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new Fd(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Ed.NO_ERROR,i=n.getStatus();if(!t||Ld(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Ed.ABORT;return void e(!1,new Fd(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Fd(s,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(tp){r(tp)}else if(null!==i){const e=Sd();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?Nd():Rd())}else{r(kd())}};this.canceled_?t(0,new Fd(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function l(){return 2===a}let c=!1;function h(){if(!c){c=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function u(t){i=setTimeout((()=>{i=null,e(p,l())}),t)}function d(){s&&clearTimeout(s)}function p(e){if(c)return void d();for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e)return d(),void h.call(null,e,...n);if(l()||o)return d(),void h.call(null,e,...n);let s;r<64&&(r*=2),1===a?(a=2,s=0):s=1e3*(r+Math.random()),u(s)}let f=!1;function m(e){f||(f=!0,d(),c||(null!==i?(e||(a=2),clearTimeout(i),u(0)):e||(a=1)))}return u(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Fd{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Ud(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}class jd{constructor(e,t){this._service=e,this._location=t instanceof Od?t:Od.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new jd(e,t)}get root(){const e=new Od(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ud(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Od(this._location.bucket,e);return new jd(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new bd(Id.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function $d(e,t){const n=null===t||void 0===t?void 0:t[Cd];return null==n?null:Od.makeFromBucketSpec(n,e)}class Hd{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=wd,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Od.makeFromBucketSpec(r,this._host):$d(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Od.makeFromBucketSpec(this._url,e):this._bucket=$d(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){xd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){xd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new jd(this,e)}_makeRequest(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new Ad(Nd());{const s=function(e,t,n,r,i,s){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=Dd(e.urlParams),l=e.url+a,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new Md(l,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const Wd="@firebase/storage",qd="0.13.7",Vd="storage";function Bd(e,t){let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new Hd(r,i,s,n,fr)}cr(new Zt(Vd,Bd,"PUBLIC").setMultipleInstances(!0)),_r(Wd,qd,""),_r(Wd,qd,"esm2017");const zd=mr({apiKey:"AIzaSyAGifnwsyeq-GGUXEeVLgzyBgG-B7nCsNQ",authDomain:"chatapp-saas.firebaseapp.com",databaseURL:"https://chatapp-saas-default-rtdb.firebaseio.com",projectId:"chatapp-saas",storageBucket:"chatapp-saas.appspot.com",messagingSenderId:"532703155376",appId:"1:532703155376:web:edabd668650939fa9b5775",measurementId:"G-Q9KK98H1ZG"}),Kd=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gr();const t=hr(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=hr(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Wt(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Dr(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:qo,persistence:[Xs,Ls,Fs]}),r=Tt("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ko)return;const r=null===t||void 0===t?void 0:t.token;Go!==r&&(Go=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){Xt(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){Xt(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}var i;const s=bt("auth");return s&&ts(n,`http://${s}`),n}(zd),Gd=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gr(),t=arguments.length>1?arguments[1]:void 0;const n=hr(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=It("database");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Xt(e),e._checkNotDeleted("useEmulator");const i=`${t}:${n}`,s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&Wt(r,s.repoInfo_.emulatorOptions))return;ga("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&ga('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Da(Da.OWNER);else if(r.mockUserToken){const t="string"===typeof r.mockUserToken?r.mockUserToken:kt(r.mockUserToken,e.app.options.projectId);o=new Da(t)}!function(e,t,n,r){e.repoInfo_=new $a(t,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(e.authTokenProvider_=r)}(s,i,r,o)}(n,...e)}return n}(zd);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gr(),t=arguments.length>1?arguments[1]:void 0;e=Xt(e);const n=hr(e,Vd).getImmediate({identifier:t}),r=It("storage");r&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:kt(i,e.app.options.projectId))}(e,t,n,r)}(n,...r)}(zd);var Yd=n(579);const Jd=()=>{const[e,t]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),s=ee();return(0,Yd.jsxs)("div",{children:[(0,Yd.jsx)("h2",{children:"\u0110\u0103ng nh\u1eadp"}),(0,Yd.jsx)("input",{type:"email",placeholder:"Email",onChange:e=>t(e.target.value)}),(0,Yd.jsx)("input",{type:"password",placeholder:"M\u1eadt kh\u1ea9u",onChange:e=>i(e.target.value)}),(0,Yd.jsx)("button",{onClick:async()=>{try{await function(e,t,n){return ur(e.app)?Promise.reject(Fr(e)):Ps(Xt(e),fs.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Ns(e),t}))}(Kd,e,n),s("/chat")}catch(ma){console.error("Login error:",ma)}},children:"\u0110\u0103ng nh\u1eadp b\u1eb1ng Email"}),(0,Yd.jsx)("button",{onClick:async()=>{const e=new vs;try{await async function(e,t,n){if(ur(e.app))return Promise.reject(Lr(e,"operation-not-supported-in-this-environment"));const r=qi(e);Ur(e,t,ms);const i=io(r,n);return new uo(r,"signInViaPopup",t,i).executeNotNull()}(Kd,e),s("/chat")}catch(ma){console.error("Google login error:",ma)}},children:"\u0110\u0103ng nh\u1eadp b\u1eb1ng Google"}),(0,Yd.jsxs)("p",{children:["B\u1ea1n ch\u01b0a c\xf3 t\xe0i kho\u1ea3n? ",(0,Yd.jsx)("a",{href:"/signup",children:"\u0110\u0103ng k\xfd ngay"})]})]})},Qd=()=>{const[e,t]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),s=ee();return(0,Yd.jsxs)("div",{children:[(0,Yd.jsx)("h2",{children:"\u0110\u0103ng k\xfd"}),(0,Yd.jsx)("input",{type:"email",placeholder:"Email",onChange:e=>t(e.target.value)}),(0,Yd.jsx)("input",{type:"password",placeholder:"M\u1eadt kh\u1ea9u",onChange:e=>i(e.target.value)}),(0,Yd.jsx)("button",{onClick:async()=>{try{await async function(e,t,n){if(ur(e.app))return Promise.reject(Fr(e));const r=qi(e),i=Zi(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Cs,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Ns(e),t})),o=await bs._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}(Kd,e,n),s("/chat")}catch(ma){console.error("Signup error:",ma)}},children:"\u0110\u0103ng k\xfd"}),(0,Yd.jsxs)("p",{children:["\u0110\xe3 c\xf3 t\xe0i kho\u1ea3n? ",(0,Yd.jsx)("a",{href:"/login",children:"\u0110\u0103ng nh\u1eadp"})]})]})},Xd=e=>e.replace(/\.|\#|\$|\[|\]/g,"_"),Zd=()=>{const[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)(""),[s,o]=(0,r.useState)([]),[a,l]=(0,r.useState)(null),[c,h]=(0,r.useState)(null),[u,d]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null);(0,r.useEffect)((()=>{const e=Kd.onAuthStateChanged((e=>{f(e),e||(l(null),t([]),o([]))}));return()=>e()}),[]),(0,r.useEffect)((()=>{if(p){md(ld(Gd,`chats/${Xd(p.email)}`),(e=>{const t=e.val();o(t?Object.keys(t):[])}))}}),[p]),(0,r.useEffect)((()=>{if(a&&p){md(ld(Gd,`chats/${Xd(p.email)}/${Xd(a)}`),(e=>{const n=e.val();t(n?Object.values(n):[])}))}}),[a,p]);return(0,Yd.jsxs)("div",{style:{display:"flex",height:"500px",border:"1px solid black"},children:[p&&(0,Yd.jsxs)("div",{style:{width:"30%",borderRight:"1px solid gray",padding:"10px"},children:[(0,Yd.jsx)("h3",{children:"Danh s\xe1ch chat"}),(0,Yd.jsx)("ul",{children:s.length>0?s.map((e=>(0,Yd.jsx)("li",{onClick:()=>l(e),style:{cursor:"pointer",margin:"5px 0"},children:e},e))):(0,Yd.jsx)("p",{children:"Kh\xf4ng c\xf3 tin nh\u1eafn"})})]}),(0,Yd.jsx)("div",{style:{flex:1,padding:"10px"},children:p?a?(0,Yd.jsxs)(Yd.Fragment,{children:[(0,Yd.jsxs)("h3",{children:["\u0110ang chat v\u1edbi: ",a]}),(0,Yd.jsx)("div",{style:{height:"350px",overflowY:"scroll",border:"1px solid gray",padding:"10px",marginBottom:"10px"},children:e.map(((e,t)=>(0,Yd.jsx)("div",{style:{marginBottom:"10px"},children:"text"===e.type?(0,Yd.jsxs)("p",{children:[(0,Yd.jsxs)("strong",{children:[e.sender,":"]})," ",e.text]}):(0,Yd.jsx)("img",{src:e.text,alt:"Uploaded",style:{maxWidth:"100%"}})},t)))}),(0,Yd.jsx)("input",{type:"text",value:n,onChange:e=>i(e.target.value),placeholder:"Nh\u1eadp tin nh\u1eafn..."}),(0,Yd.jsx)("button",{onClick:async()=>{if(!a||!p||!n.trim())return;const e=Xd(p.email),t=Xd(a),r={text:n,sender:p.email,timestamp:Date.now(),type:"text"};hd(ld(Gd,`chats/${e}/${t}`),r),hd(ld(Gd,`chats/${t}/${e}`),r),i("")},children:"G\u1eedi tin nh\u1eafn"}),(0,Yd.jsx)("br",{}),(0,Yd.jsx)("input",{type:"file",onChange:e=>h(e.target.files[0])}),(0,Yd.jsx)("button",{onClick:async()=>{if(!c||!a||!p)return;d(!0);const e=await(async e=>{const t=new FormData;t.append("file",e),t.append("upload_preset","chatapp_uploads");const n=await fetch("https://api.cloudinary.com/v1_1/ddnryyozp/upload",{method:"POST",body:t});return(await n.json()).secure_url})(c),t=Xd(p.email),n=Xd(a),r={text:e,sender:p.email,timestamp:Date.now(),type:"image"};hd(ld(Gd,`chats/${t}/${n}`),r),hd(ld(Gd,`chats/${n}/${t}`),r),h(null),d(!1)},disabled:u,children:u?"\u0110ang t\u1ea3i...":"G\u1eedi file"})]}):(0,Yd.jsx)("p",{children:"Ch\u1ecdn m\u1ed9t cu\u1ed9c tr\xf2 chuy\u1ec7n \u0111\u1ec3 b\u1eaft \u0111\u1ea7u"}):(0,Yd.jsx)("p",{children:"Vui l\xf2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng chat"})})]})};const ep=function(){return(0,Yd.jsx)(Qe,{children:(0,Yd.jsxs)(_e,{children:[(0,Yd.jsx)(me,{path:"/login",element:(0,Yd.jsx)(Jd,{})}),(0,Yd.jsx)(me,{path:"/signup",element:(0,Yd.jsx)(Qd,{})}),(0,Yd.jsx)(me,{path:"/chat",element:(0,Yd.jsx)(Zd,{})}),(0,Yd.jsx)(me,{path:"*",element:(0,Yd.jsx)(Jd,{})})]})})};i.render((0,Yd.jsx)(ep,{}),document.getElementById("root"))})();
//# sourceMappingURL=main.a74eb74e.js.map